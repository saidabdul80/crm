import{aF as te,D as H,K as ae,g as F,F as fe,a3 as ne,e as J,l as S,A as K,r as _,o as i,c as B,b as n,t as v,a,a4 as we,m as o,w as c,q as A,n as q,I as L,C as se,aE as xe,J as Be,N as R,h as U,i as X,aX as Pe,au as oe,aV as Ie,k as re,p as Z,L as Q,M as ee,O as le,aZ as Se,az as _e,al as Te,a_ as ke,H as Y,T as Ce,a$ as Me,b0 as De,aD as Ve,u as je,G as qe,W as ge,s as he,E as Ee}from"./main-4279fdc3.js";import{D as Ae,d as Le}from"./DragIcon-8d50e279.js";import{_ as Oe}from"./SelectNotePopup-ce699f43.js";const ze={class:"flex items-center justify-between mb-3"},Ue={class:"flex items-center text-base",style:{flex:"4"}},Ne={class:"pr-2 mb-0",align:"right"},Fe={class:"absolute left-3.5"},We={class:"ml-2 text-sm leading-none cursor-pointer text-primary-400"},Ge=n("br",null,null,-1),Ye={class:"text-sm text-right",style:{flex:"3"}},Re={class:"flex items-center justify-center w-6 h-10 mx-2 cursor-pointer"},Xe={props:{ability:{type:String,default:""},store:{type:Object,default:null},storeProp:{type:String,default:""},itemIndex:{type:Number,required:!0},index:{type:Number,required:!0},taxData:{type:Object,required:!0},taxes:{type:Array,default:[]},total:{type:Number,default:0},totalTax:{type:Number,default:0},discountedTotal:{type:Number,default:0},currency:{type:[Object,String],required:!0},updateItems:{type:Function,default:()=>{}}},emits:["remove","update"],setup(s,{emit:t}){const e=s,l=te(),w=H(),f=ae(),g=F(null),x=fe({...e.taxData});ne("utils");const{t:j}=J(),y=S(()=>l.taxTypes.map(u=>({...u})).map(u=>(e.taxes.find(h=>h.tax_type_id===u.id)?u.disabled=!0:u.disabled=!1,u))),E=S(()=>x.compound_tax&&e.discountedTotal?(e.discountedTotal+e.totalTax)*x.percent/100:e.discountedTotal&&x.percent?e.discountedTotal*x.percent/100:0);K(()=>e.discountedTotal,()=>{k()}),K(()=>e.totalTax,()=>{k()}),e.taxData.tax_type_id>0&&(g.value=l.taxTypes.find(m=>m.id===e.taxData.tax_type_id)),k();function D(m){x.percent=m.percent,x.tax_type_id=m.id,x.compound_tax=m.compound_tax,x.name=m.name,k()}function k(){x.tax_type_id!==0&&t("update",{index:e.index,item:{...x,amount:E.value}})}function d(){let m={itemIndex:e.itemIndex,taxIndex:e.index};w.openModal({title:j("settings.tax_types.add_tax"),componentName:"TaxTypeModal",data:m,size:"sm"})}function r(m){e.store.$patch(u=>{u[e.storeProp].items[e.itemIndex].taxes.splice(m,1)})}return(m,u)=>{const V=_("BaseIcon"),h=_("BaseMultiselect"),T=_("BaseFormatMoney");return i(),B("div",ze,[n("div",Ue,[n("label",Ne,v(m.$t("invoices.item.tax")),1),a(h,{modelValue:g.value,"onUpdate:modelValue":[u[0]||(u[0]=C=>g.value=C),u[1]||(u[1]=C=>D(C))],"value-prop":"id",options:o(y),placeholder:m.$t("general.select_a_tax"),"open-direction":"top","track-by":"name",searchable:"",object:"",label:"name"},we({singlelabel:c(({value:C})=>[n("div",Fe,v(C.name)+" - "+v(C.percent)+" % ",1)]),option:c(({option:C})=>[A(v(C.name)+" - "+v(C.percent)+" % ",1)]),_:2},[o(f).hasAbilities(s.ability)?{name:"action",fn:c(()=>[n("button",{type:"button",class:"flex items-center justify-center w-full px-2 py-2 bg-gray-200 border-none outline-none cursor-pointer",onClick:d},[a(V,{name:"CheckCircleIcon",class:"h-5 text-primary-400"}),n("label",We,v(m.$t("invoices.add_new_tax")),1)])])}:void 0]),1032,["modelValue","options","placeholder"]),Ge]),n("div",Ye,[a(T,{amount:o(E),currency:s.currency},null,8,["amount","currency"])]),n("div",Re,[s.taxes.length&&s.index!==s.taxes.length-1?(i(),q(V,{key:0,name:"TrashIcon",class:"h-5 text-gray-700 cursor-pointer",onClick:u[2]||(u[2]=C=>r(s.index))})):L("",!0)])])}}},He={class:"box-border bg-white border border-gray-200 border-solid rounded-b"},Je={colspan:"5",class:"p-0 text-left align-top"},Ke={class:"w-full"},Qe=n("col",{style:{width:"40%","min-width":"280px"}},null,-1),Ze=n("col",{style:{width:"10%","min-width":"120px"}},null,-1),et=n("col",{style:{width:"15%","min-width":"120px"}},null,-1),tt={key:0,style:{width:"15%","min-width":"160px"}},st=n("col",{style:{width:"15%","min-width":"120px"}},null,-1),ot={class:"px-5 py-4 text-left align-top"},at={class:"flex justify-start"},nt={class:"flex items-center justify-center w-5 h-5 mt-2 mr-2 text-gray-300 cursor-move handle"},rt={class:"px-5 py-4 text-right align-top flex items-center"},lt={class:"bg="},it={class:"px-5 py-4 text-left align-top"},dt={class:"flex flex-col"},ct={class:"flex-auto flex-fill bd-highlight"},ut={class:"relative w-full"},mt={key:0,class:"px-5 py-4 text-left align-top"},pt={class:"flex flex-col"},yt={class:"flex",style:{width:"120px"},role:"group"},ft={class:"flex items-center"},xt={class:"px-5 py-4 text-right align-top"},_t={class:"flex items-center justify-end text-sm"},gt={class:"flex items-center"},ht={class:"flex items-center justify-center w-6 h-10 mx-2"},vt={key:0},bt=n("td",{class:"px-5 py-4 text-left align-top"},null,-1),$t={colspan:"4",class:"px-5 py-4 text-left align-top"},wt={props:{store:{type:Object,default:null},storeProp:{type:String,default:""},itemData:{type:Object,default:null},index:{type:Number,default:null},type:{type:String,default:""},loading:{type:Boolean,default:!1},currency:{type:[Object,String],required:!0},invoiceItems:{type:Array,required:!0},itemValidationScope:{type:String,default:""}},emits:["update","remove","itemValidate"],setup(s,{emit:t}){const e=s;se();const l=xe();Be();const{t:w}=J(),f=F(0),g=S({get:()=>e.itemData.quantity,set:p=>{z("quantity",parseFloat(p))}}),x=F(0),j=S(()=>e.itemData.price*e.itemData.quantity),y=S({get:()=>e.itemData.discount,set:p=>{e.itemData.discount_type==="percentage"?z("discount_val",j.value*p):z("discount_val",Math.round(p)),z("discount",p)}}),E=S(()=>e.store[e.storeProp].items.length!=1),D=S(()=>Math.round(R.exports.sumBy(e.itemData.taxes,function(p){return p.compound_tax?0:p.amount}))),k=S(()=>Math.round(R.exports.sumBy(e.itemData.taxes,function(p){return p.compound_tax?p.amount:0}))),d=S(()=>D.value+k.value),r=F(!1),m=function(){var P,I;const p=(P=e.store[e.storeProp])==null?void 0:P.exchange_rate;p?(x.value=p,(I=e.store[e.storeProp])!=null&&I.fliped?f.value=(g.value/p).toFixed(2)-e.itemData.discount_val:f.value=(g.value*p).toFixed(2)-e.itemData.discount_val):f.value=0,e.store[e.storeProp].request_total=g,setTimeout(()=>{r.value=!1},500)},u=function(){var P,I;const p=(P=e.store[e.storeProp])==null?void 0:P.exchange_rate;p?(x.value=p,(I=e.store[e.storeProp])!=null&&I.fliped?f.value=(g.value*p).toFixed(2)-e.itemData.discount_val:f.value=(g.value/p).toFixed(2)-e.itemData.discount_val):f.value=0,e.store[e.storeProp].request_total=g,setTimeout(()=>{r.value=!1},500)},V=function(){var P,I;const p=(P=e.store[e.storeProp])==null?void 0:P.exchange_rate;p?(x.value=p,(I=e.store[e.storeProp])!=null&&I.fliped?g.value=(f.value*p).toFixed(2):g.value=(f.value/p).toFixed(2)):f.value=0,e.store[e.storeProp].request_total=g,setTimeout(()=>{r.value=!1},500)};K(()=>e.store[e.storeProp],(p,P)=>{r.value||(m(),r.value=!0)},{deep:!0,immediate:!0}),K(()=>g.value,(p,P)=>{r.value||(u(),r.value=!0)},{immediate:!0,shallow:!0}),K(()=>f.value,(p,P)=>{r.value||(V(),r.value=!0)},{immediate:!0,shallow:!0});const h={name:{required:U.withMessage(w("validation.required"),X)},quantity:{required:U.withMessage(w("validation.required"),X),minValue:U.withMessage(w("validation.qty_must_greater_than_zero"),Pe(0)),maxLength:U.withMessage(w("validation.amount_maxlength"),oe(20))},discount_val:{between:U.withMessage(w("validation.discount_maxlength"),Ie(0,S(()=>j.value)))},description:{maxLength:U.withMessage(w("validation.notes_maxlength"),oe(65e3))}},T=re(h,S(()=>e.store[e.storeProp].items[e.index]),{$scope:e.itemValidationScope});function C(p){e.store.$patch(I=>{I[e.storeProp].items[e.index].taxes[p.index]=p.item});let P=e.itemData.taxes[e.itemData.taxes.length-1];(P==null?void 0:P.tax_type_id)!==0&&e.store.$patch(I=>{I[e.storeProp].items[e.index].taxes.push({...Se,id:_e.raw()})}),W()}function b(p){z("name",p)}function $(p){e.store.$patch(P=>{if(P[e.storeProp].items[e.index].name=p.name,P[e.storeProp].items[e.index].price=p.price,P[e.storeProp].items[e.index].item_id=p.id,P[e.storeProp].items[e.index].description=p.description,p.unit&&(P[e.storeProp].items[e.index].unit_name=p.unit.name),e.store[e.storeProp].tax_per_item==="YES"&&p.taxes){let I=0;p.taxes.forEach(G=>{C({index:I,item:{...G}}),I++})}}),l.fetchItems(),W()}function M(){e.itemData.discount_type!=="fixed"&&(z("discount_val",Math.round(e.itemData.discount)),z("discount_type","fixed"))}function O(){e.itemData.discount_type!=="percentage"&&(z("discount_val",j.value*e.itemData.discount/100),z("discount_type","percentage"))}function W(){var I,G;let p=(G=(I=e.store[e.storeProp])==null?void 0:I.items[e.index])==null?void 0:G.taxes;p||(p=[]);let P={...e.store[e.storeProp].items[e.index],index:e.index,total:f.value,sub_total:j.value,totalSimpleTax:D.value,totalCompoundTax:k.value,totalTax:d.value,tax:d.value,taxes:[...p]};e.store.updateItem(P)}function z(p,P){e.store.$patch(I=>{I[e.storeProp].items[e.index][p]=P}),W()}return(p,P)=>{var me,pe,ye;const I=_("BaseItemSelect"),G=_("BaseInput"),ie=_("BaseIcon"),ve=_("BaseButton"),de=_("BaseDropdownItem"),be=_("BaseDropdown"),ce=_("BaseContentPlaceholdersText"),ue=_("BaseContentPlaceholders");return i(),B("tr",He,[n("td",Je,[n("table",Ke,[n("colgroup",null,[Qe,Ze,et,s.store[s.storeProp].discount_per_item==="YES"?(i(),B("col",tt)):L("",!0),st]),n("tbody",null,[n("tr",null,[n("td",ot,[n("div",at,[n("div",nt,[a(Ae)]),a(I,{type:"Invoice",item:s.itemData,invalid:o(T).name.$error,"invalid-description":o(T).description.$error,taxes:s.itemData.taxes,index:s.index,"store-prop":s.storeProp,store:s.store,onSearch:b,onSelect:$},null,8,["item","invalid","invalid-description","taxes","index","store-prop","store"])])]),n("td",rt,[n("div",lt,v((pe=(me=s.store[s.storeProp])==null?void 0:me.currency)==null?void 0:pe.symbol),1),a(G,{modelValue:o(g),"onUpdate:modelValue":P[0]||(P[0]=N=>Z(g)?g.value=N:null),invalid:o(T).quantity.$error,"content-loading":s.loading,type:"number",small:"",min:"0",step:"any",onChange:P[1]||(P[1]=N=>W()),onInput:P[2]||(P[2]=N=>o(T).quantity.$touch())},null,8,["modelValue","invalid","content-loading"])]),n("td",it,[n("div",dt,[n("div",ct,[n("div",ut,v(x.value),1)])])]),s.store[s.storeProp].discount_per_item==="YES"?(i(),B("td",mt,[n("div",pt,[n("div",yt,[a(G,{modelValue:o(y),"onUpdate:modelValue":P[3]||(P[3]=N=>Z(y)?y.value=N:null),invalid:o(T).discount_val.$error,"content-loading":s.loading,class:"border-r-0 focus:border-r-2 rounded-tr-sm rounded-br-sm h-[38px]"},null,8,["modelValue","invalid","content-loading"]),a(be,{position:"bottom-end"},{activator:c(()=>[a(ve,{"content-loading":s.loading,class:"rounded-tr-md rounded-br-md !p-2 rounded-none",type:"button",variant:"white"},{default:c(()=>[n("span",ft,[A(v(s.itemData.discount_type=="fixed"?s.currency.symbol:"%")+" ",1),a(ie,{name:"ChevronDownIcon",class:"w-4 h-4 ml-1 text-gray-500"})])]),_:1},8,["content-loading"])]),default:c(()=>[a(de,{onClick:M},{default:c(()=>[A(v(p.$t("general.fixed")),1)]),_:1}),a(de,{onClick:O},{default:c(()=>[A(v(p.$t("general.percentage")),1)]),_:1})]),_:1})])])])):L("",!0),n("td",xt,[n("div",_t,[n("span",null,[s.loading?(i(),q(ue,{key:0},{default:c(()=>[a(ce,{lines:1,class:"w-16 h-5"})]),_:1})):L("",!0),n("div",gt,[A(v((ye=e.store[e.storeProp].from_currency)==null?void 0:ye.symbol)+" ",1),a(G,{modelValue:f.value,"onUpdate:modelValue":P[4]||(P[4]=N=>f.value=N),invalid:o(T).discount_val.$error,"content-loading":s.loading,class:"border-r-0 focus:border-r-2 rounded-tr-sm rounded-l-sm h-[38px]"},null,8,["modelValue","invalid","content-loading"])])]),n("div",ht,[o(E)?(i(),q(ie,{key:0,class:"h-5 text-gray-700 cursor-pointer",name:"TrashIcon",onClick:P[5]||(P[5]=N=>s.store.removeItem(s.index))})):L("",!0)])])])]),s.store[s.storeProp].tax_per_item==="YES"?(i(),B("tr",vt,[bt,n("td",$t,[s.loading?(i(),q(ue,{key:0},{default:c(()=>[a(ce,{lines:1,class:"w-24 h-8 border rounded-md"})]),_:1})):(i(!0),B(Q,{key:1},ee(s.itemData.taxes,(N,$e)=>(i(),q(Xe,{key:N.id,index:$e,"item-index":s.index,"tax-data":N,taxes:s.itemData.taxes,"discounted-total":f.value,"total-tax":o(D),total:o(j),currency:s.currency,"update-items":W,ability:o(le).CREATE_INVOICE,store:s.store,"store-prop":s.storeProp,discount:o(y),onUpdate:C},null,8,["index","item-index","tax-data","taxes","discounted-total","total-tax","total","currency","ability","store","store-prop","discount"]))),128))])])):L("",!0)])])])])}}},Bt={class:"text-center item-table min-w-full"},Pt=n("col",{style:{width:"40%","min-width":"280px"}},null,-1),It=n("col",{style:{width:"10%","min-width":"120px"}},null,-1),St=n("col",{style:{width:"15%","min-width":"120px"}},null,-1),Tt={key:0,style:{width:"15%","min-width":"160px"}},kt=n("col",{style:{width:"15%","min-width":"120px"}},null,-1),Ct={class:"bg-white border border-gray-200 border-solid"},Mt={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},Dt={key:1,class:"pl-7"},Vt={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-right text-gray-700 border-t border-b border-gray-200 border-solid"},jt={key:1},qt={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},Et={key:1},At={key:0,class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},Lt={key:1},Ot={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-right text-gray-700 border-t border-b border-gray-200 border-solid"},zt={key:1,class:"pr-10 column-heading"},Rs={props:{store:{type:Object,default:null},storeProp:{type:String,default:""},currency:{type:[Object,String,null],required:!0},isLoading:{type:Boolean,default:!1},itemValidationScope:{type:String,default:""}},setup(s){const t=s,e=se(),l=S(()=>t.currency?t.currency:e.selectedCompanyCurrency);return(w,f)=>{const g=_("BaseContentPlaceholdersText"),x=_("BaseContentPlaceholders"),j=_("BaseIcon");return i(),B(Q,null,[n("table",Bt,[n("colgroup",null,[Pt,It,St,s.store[s.storeProp].discount_per_item==="YES"?(i(),B("col",Tt)):L("",!0),kt]),n("thead",Ct,[n("tr",null,[n("th",Mt,[s.isLoading?(i(),q(x,{key:0},{default:c(()=>[a(g,{lines:1,class:"w-16 h-5"})]),_:1})):(i(),B("span",Dt,v(w.$t("items.item",2)),1))]),n("th",Vt,[s.isLoading?(i(),q(x,{key:0},{default:c(()=>[a(g,{lines:1,class:"w-16 h-5"})]),_:1})):(i(),B("span",jt,v(w.$t("invoices.item.quantity")),1))]),n("th",qt,[s.isLoading?(i(),q(x,{key:0},{default:c(()=>[a(g,{lines:1,class:"w-16 h-5"})]),_:1})):(i(),B("span",Et," Rate "))]),s.store[s.storeProp].discount_per_item==="YES"?(i(),B("th",At,[s.isLoading?(i(),q(x,{key:0},{default:c(()=>[a(g,{lines:1,class:"w-16 h-5"})]),_:1})):(i(),B("span",Lt,v(w.$t("invoices.item.discount")),1))])):L("",!0),n("th",Ot,[s.isLoading?(i(),q(x,{key:0},{default:c(()=>[a(g,{lines:1,class:"w-16 h-5"})]),_:1})):(i(),B("span",zt,v(w.$t("invoices.item.amount")),1))])])]),a(o(Le),{modelValue:s.store[s.storeProp].items,"onUpdate:modelValue":f[0]||(f[0]=y=>s.store[s.storeProp].items=y),"item-key":"id",tag:"tbody",handle:".handle"},{item:c(({element:y,index:E})=>[a(wt,{key:y.id,index:E,"item-data":y,loading:s.isLoading,currency:o(l),"item-validation-scope":s.itemValidationScope,"invoice-items":s.store[s.storeProp].items,store:s.store,"store-prop":s.storeProp},null,8,["index","item-data","loading","currency","item-validation-scope","invoice-items","store","store-prop"])]),_:1},8,["modelValue"])]),n("div",{class:"flex items-center justify-center w-full px-6 py-3 text-base border border-t-0 border-gray-200 border-solid cursor-pointer text-primary-400 hoverbg-gray-100",onClick:f[1]||(f[1]=(...y)=>s.store.addItem&&s.store.addItem(...y))},[a(j,{name:"PlusCircleIcon",class:"mr-2"}),A(" "+v(w.$t("general.add_new_item")),1)])],64)}}},Ut={class:"flex items-center justify-between w-full mt-2 text-sm"},Nt={class:"font-semibold leading-5 text-gray-500 uppercase"},Ft={class:"flex items-center justify-center text-lg text-black"},Wt={props:{index:{type:Number,required:!0},tax:{type:Object,required:!0},taxes:{type:Array,required:!0},currency:{type:[Object,String],required:!0},store:{type:Object,default:null},data:{type:String,default:""}},emits:["update","remove"],setup(s,{emit:t}){const e=s;ne("$utils");const l=S(()=>e.tax.compound_tax&&e.store.getSubtotalWithDiscount?Math.round((e.store.getSubtotalWithDiscount+e.store.getTotalSimpleTax)*e.tax.percent/100):e.store.getSubtotalWithDiscount&&e.tax.percent?Math.round(e.store.getSubtotalWithDiscount*e.tax.percent/100):0);Te(()=>{e.store.getSubtotalWithDiscount&&w(),e.store.getTotalSimpleTax&&w()});function w(){t("update",{...e.tax,amount:l.value})}return(f,g)=>{const x=_("BaseFormatMoney"),j=_("BaseIcon");return i(),B("div",Ut,[n("label",Nt,v(s.tax.name)+" ("+v(s.tax.percent)+" %) ",1),n("label",Ft,[a(x,{amount:s.tax.amount,currency:s.currency},null,8,["amount","currency"]),a(j,{name:"TrashIcon",class:"h-5 ml-2 cursor-pointer",onClick:g[0]||(g[0]=y=>f.$emit("remove",s.tax.id))})])])}}},Gt={class:"w-full mt-4 tax-select"},Yt={class:"relative w-full max-w-md px-4"},Rt={class:"overflow-hidden rounded-md shadow-lg ring-1 ring-black ring-opacity-5"},Xt={class:"relative bg-white"},Ht={class:"relative p-4"},Jt={key:0,class:"relative flex flex-col overflow-auto list max-h-36 border-t border-gray-200"},Kt=["onClick"],Qt={class:"flex justify-between px-2"},Zt={class:"m-0 text-base font-semibold leading-tight text-gray-700 cursor-pointer"},es={class:"m-0 text-base font-semibold text-gray-700 cursor-pointer"},ts={key:1,class:"flex justify-center p-5 text-gray-400"},ss={class:"text-base text-gray-500 cursor-pointer"},os={class:"m-0 ml-3 text-sm leading-none cursor-pointer font-base text-primary-400"},as={props:{type:{type:String,default:null},store:{type:Object,default:null},storeProp:{type:String,default:""}},emits:["select:taxType"],setup(s,{emit:t}){const e=s,l=H(),w=te(),f=ae(),{t:g}=J(),x=F(null),j=S(()=>x.value?w.taxTypes.filter(function(k){return k.name.toLowerCase().indexOf(x.value.toLowerCase())!==-1}):w.taxTypes),y=S(()=>e.store[e.storeProp].taxes);function E(k,d){t("select:taxType",{...k}),d()}function D(){l.openModal({title:g("settings.tax_types.add_tax"),componentName:"TaxTypeModal",size:"sm",refreshData:k=>t("select:taxType",k)})}return(k,d)=>{const r=_("BaseIcon"),m=_("BaseInput");return i(),B("div",Gt,[a(o(De),{class:"relative"},{default:c(({isOpen:u})=>[a(o(ke),{class:Y([u?"":"text-opacity-90","flex items-center text-sm font-medium text-primary-400 focus:outline-none focus:border-none"])},{default:c(()=>[a(r,{name:"PlusIcon",class:"w-4 h-4 font-medium text-primary-400"}),A(" "+v(k.$t("settings.tax_types.add_tax")),1)]),_:2},1032,["class"]),n("div",Yt,[a(Ce,{"enter-active-class":"transition duration-200 ease-out","enter-from-class":"translate-y-1 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition duration-150 ease-in","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-1 opacity-0"},{default:c(()=>[a(o(Me),{style:{"min-width":"350px","margin-left":"62px",top:"-28px"},class:"absolute z-10 px-4 py-2 -translate-x-full sm:px-0"},{default:c(({close:V})=>[n("div",Rt,[n("div",Xt,[n("div",Ht,[a(m,{modelValue:x.value,"onUpdate:modelValue":d[0]||(d[0]=h=>x.value=h),placeholder:k.$t("general.search"),type:"text",class:"text-black"},null,8,["modelValue","placeholder"])]),o(j).length>0?(i(),B("div",Jt,[(i(!0),B(Q,null,ee(o(j),(h,T)=>(i(),B("div",{key:T,class:Y([{"bg-gray-100 cursor-not-allowed opacity-50 pointer-events-none":o(y).find(C=>C.tax_type_id===h.id)},"px-6 py-4 border-b border-gray-200 border-solid cursor-pointer hover:bg-gray-100 hover:cursor-pointer last:border-b-0"]),tabindex:"2",onClick:C=>E(h,V)},[n("div",Qt,[n("label",Zt,v(h.name),1),n("label",es,v(h.percent)+" % ",1)])],10,Kt))),128))])):(i(),B("div",ts,[n("label",ss,v(k.$t("general.no_tax_found")),1)]))]),o(f).hasAbilities(o(le).CREATE_TAX_TYPE)?(i(),B("button",{key:0,type:"button",class:"flex items-center justify-center w-full h-10 px-2 py-3 bg-gray-200 border-none outline-none",onClick:D},[a(r,{name:"CheckCircleIcon",class:"text-primary-400"}),n("label",os,v(k.$t("estimates.add_new_tax")),1)])):L("",!0)])]),_:1})]),_:1})])]),_:1})])}}},ns={class:"px-5 py-4 mt-6 bg-white border border-gray-200 border-solid rounded md:min-w-[390px] min-w-[300px] lg:mt-7"},rs={class:"flex items-center justify-between w-full"},ls={key:1,class:"text-sm font-semibold leading-5 text-gray-400 uppercase"},is={key:3,class:"flex items-center justify-center m-0 text-lg text-black uppercase"},ds={key:1,class:"m-0 text-sm font-semibold leading-5 text-gray-500 uppercase"},cs={key:3,class:"flex items-center justify-center m-0 text-lg text-black uppercase"},us={key:0,class:"flex items-center justify-between w-full mt-2"},ms={key:1,class:"text-sm font-semibold leading-5 text-gray-400 uppercase"},ps={key:3,class:"flex",style:{width:"140px"},role:"group"},ys={class:"flex items-center"},fs={key:1},xs={class:"flex items-center justify-between w-full pt-2 mt-5 border-t border-gray-200 border-solid"},_s={key:1,class:"m-0 text-sm font-semibold leading-5 text-gray-400 uppercase"},gs={key:3,class:"flex items-center justify-center text-lg uppercase text-primary-400"},Xs={props:{store:{type:Object,default:null},storeProp:{type:String,default:""},taxPopupType:{type:String,default:""},currency:{type:[Object,String],default:""},isLoading:{type:Boolean,default:!1}},setup(s){const t=s,e=F(null);ne("$utils");const l=se(),w=S({get:()=>t.store[t.storeProp].discount,set:d=>{t.store[t.storeProp].discount_type==="percentage"?t.store[t.storeProp].discount_val=Math.round(t.store.getSubTotal*d/100):t.store[t.storeProp].discount_val=Math.round(d*100),t.store[t.storeProp].discount=d}}),f=S({get:()=>t.store[t.storeProp].taxes,set:d=>{t.store.$patch(r=>{r[t.storeProp].taxes=d})}}),g=S(()=>{let d=[];return t.store[t.storeProp].items.forEach(r=>{r.taxes&&r.taxes.forEach(m=>{let u=d.find(V=>V.tax_type_id===m.tax_type_id);u?u.amount+=m.amount:m.tax_type_id&&d.push({tax_type_id:m.tax_type_id,amount:m.amount,percent:m.percent,name:m.name})})}),d}),x=S(()=>t.currency?t.currency:l.selectedCompanyCurrency);function j(){t.store[t.storeProp].discount_type!=="fixed"&&(t.store[t.storeProp].discount_val=Math.round(t.store[t.storeProp].discount*100),t.store[t.storeProp].discount_type="fixed")}function y(){t.store[t.storeProp].discount_type!=="percentage"&&(t.store[t.storeProp].discount_val=t.store.getSubTotal*t.store[t.storeProp].discount/100,t.store[t.storeProp].discount_type="percentage")}function E(d){let r=0;d.compound_tax&&t.store.getSubtotalWithDiscount?r=Math.round((t.store.getSubtotalWithDiscount+t.store.getTotalSimpleTax)*d.percent/100):t.store.getSubtotalWithDiscount&&d.percent&&(r=Math.round(t.store.getSubtotalWithDiscount*d.percent/100));let m={...le,id:_e.raw(),name:d.name,percent:d.percent,compound_tax:d.compound_tax,tax_type_id:d.id,amount:r};t.store.$patch(u=>{u[t.storeProp].taxes.push({...m})})}function D(d){const r=t.store[t.storeProp].taxes.find(m=>m.id===d.id);r&&Object.assign(r,{...d})}function k(d){const r=t.store[t.storeProp].taxes.findIndex(m=>m.id===d);t.store.$patch(m=>{m[t.storeProp].taxes.splice(r,1)})}return(d,r)=>{const m=_("BaseContentPlaceholdersText"),u=_("BaseContentPlaceholders"),V=_("BaseFormatMoney"),h=_("BaseInput"),T=_("BaseIcon"),C=_("BaseButton"),b=_("BaseDropdownItem"),$=_("BaseDropdown");return i(),B("div",ns,[n("div",rs,[s.isLoading?(i(),q(u,{key:0},{default:c(()=>[a(m,{lines:1,class:"w-16 h-5"})]),_:1})):(i(),B("label",ls,v(d.$t("estimates.sub_total")),1)),s.isLoading?(i(),q(u,{key:2},{default:c(()=>[a(m,{lines:1,class:"w-16 h-5"})]),_:1})):(i(),B("label",is,[a(V,{amount:s.store.getSubTotal,currency:o(x)},null,8,["amount","currency"])]))]),(i(!0),B(Q,null,ee(o(g),M=>(i(),B("div",{key:M.tax_type_id,class:"flex items-center justify-between w-full"},[s.isLoading?(i(),q(u,{key:0},{default:c(()=>[a(m,{lines:1,class:"w-16 h-5"})]),_:1})):s.store[s.storeProp].tax_per_item==="YES"?(i(),B("label",ds,v(M.name)+" - "+v(M.percent)+"% ",1)):L("",!0),s.isLoading?(i(),q(u,{key:2},{default:c(()=>[a(m,{lines:1,class:"w-16 h-5"})]),_:1})):s.store[s.storeProp].tax_per_item==="YES"?(i(),B("label",cs,[a(V,{amount:M.amount,currency:o(x)},null,8,["amount","currency"])])):L("",!0)]))),128)),s.store[s.storeProp].discount_per_item==="NO"||s.store[s.storeProp].discount_per_item===null?(i(),B("div",us,[s.isLoading?(i(),q(u,{key:0},{default:c(()=>[a(m,{lines:1,class:"w-16 h-5"})]),_:1})):(i(),B("label",ms,v(d.$t("estimates.discount")),1)),s.isLoading?(i(),q(u,{key:2},{default:c(()=>[a(m,{lines:1,class:"w-24 h-8 border rounded-md"})]),_:1})):(i(),B("div",ps,[a(h,{modelValue:o(w),"onUpdate:modelValue":r[0]||(r[0]=M=>Z(w)?w.value=M:null),class:"border-r-0 focus:border-r-2 rounded-tr-sm rounded-br-sm h-[38px]"},null,8,["modelValue"]),a($,{position:"bottom-end"},{activator:c(()=>[a(C,{class:"p-2 rounded-none rounded-tr-md rounded-br-md",type:"button",variant:"white"},{default:c(()=>[n("span",ys,[A(v(s.store[s.storeProp].discount_type=="fixed"?o(x).symbol:"%")+" ",1),a(T,{name:"ChevronDownIcon",class:"w-4 h-4 ml-1 text-gray-500"})])]),_:1})]),default:c(()=>[a(b,{onClick:j},{default:c(()=>[A(v(d.$t("general.fixed")),1)]),_:1}),a(b,{onClick:y},{default:c(()=>[A(v(d.$t("general.percentage")),1)]),_:1})]),_:1})]))])):L("",!0),s.store[s.storeProp].tax_per_item==="NO"||s.store[s.storeProp].tax_per_item===null?(i(),B("div",fs,[(i(!0),B(Q,null,ee(o(f),(M,O)=>(i(),q(Wt,{key:M.id,index:O,tax:M,taxes:o(f),currency:s.currency,store:s.store,onRemove:k,onUpdate:D},null,8,["index","tax","taxes","currency","store"]))),128))])):L("",!0),s.store[s.storeProp].tax_per_item==="NO"||s.store[s.storeProp].tax_per_item===null?(i(),B("div",{key:2,ref:(M,O)=>{O.taxModal=M,e.value=M},class:"float-right pt-2 pb-4"},[a(as,{"store-prop":s.storeProp,store:s.store,type:s.taxPopupType,"onSelect:taxType":E},null,8,["store-prop","store","type"])],512)):L("",!0),n("div",xs,[s.isLoading?(i(),q(u,{key:0},{default:c(()=>[a(m,{lines:1,class:"w-16 h-5"})]),_:1})):(i(),B("label",_s,v(d.$t("estimates.total"))+" "+v(d.$t("estimates.amount"))+":",1)),s.isLoading?(i(),q(u,{key:2},{default:c(()=>[a(m,{lines:1,class:"w-16 h-5"})]),_:1})):(i(),B("label",gs,[a(V,{amount:s.store.getTotal,currency:o(x)},null,8,["amount","currency"])]))])])}}},hs={class:"flex text-gray-800 font-medium text-sm mb-2"},vs=n("span",{class:"text-sm text-red-500"}," *",-1),Hs={props:{store:{type:Object,default:null},storeProp:{type:String,default:""},isMarkAsDefault:{type:Boolean,default:!1}},setup(s){const t=s,e=H(),{t:l}=J();function w(){let f="";t.storeProp=="newEstimate"?f=l("estimates.mark_as_default_estimate_template_description"):t.storeProp=="newInvoice"&&(f=l("invoices.mark_as_default_invoice_template_description")),e.openModal({title:l("general.choose_template"),componentName:"SelectTemplate",data:{templates:t.store.templates,store:t.store,storeProp:t.storeProp,isMarkAsDefault:t.isMarkAsDefault,markAsDefaultDescription:f}})}return(f,g)=>{const x=_("BaseIcon"),j=_("BaseButton");return i(),B("div",null,[n("label",hs,[A(v(f.$t("general.select_template"))+" ",1),vs]),a(j,{type:"button",class:"flex justify-center w-full text-sm lg:w-auto hover:bg-gray-200",variant:"gray",onClick:w},{right:c(y=>[a(x,{name:"PencilIcon",class:Y(y.class)},null,8,["class"])]),default:c(()=>[A(" "+v(s.store[s.storeProp].template_name),1)]),_:1})])}}},bs={class:"mb-6"},$s={class:"z-20 text-sm font-semibold leading-5 text-primary-400 float-right"},ws={class:"text-gray-800 font-medium mb-4 text-sm"},Js={props:{store:{type:Object,default:null},storeProp:{type:String,default:""},fields:{type:Array,default:[]},type:{type:String,default:null}},setup(s){const t=s;function e(l){t.store[t.storeProp].notes=""+l.notes}return(l,w)=>{const f=_("BaseCustomInput");return i(),B("div",bs,[n("div",$s,[a(Oe,{type:s.type,onSelect:e},null,8,["type"])]),n("label",ws,v(l.$t("invoices.notes")),1),a(f,{modelValue:s.store[s.storeProp].notes,"onUpdate:modelValue":w[0]||(w[0]=g=>s.store[s.storeProp].notes=g),"content-loading":s.store.isFetchingInitialSettings,fields:s.fields,class:"mt-1"},null,8,["modelValue","content-loading","fields"])])}}},Bs={class:"flex justify-between w-full"},Ps={class:"px-8 py-8 sm:p-6"},Is={key:0,class:"grid grid-cols-3 gap-2 p-1 overflow-x-auto"},Ss=["onClick"],Ts=["src","alt"],ks=["alt","src"],Cs={key:1,class:"z-0 flex ml-3 pt-5"},Ms={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},Ks={setup(s){const t=H(),e=ae(),l=F(""),w=S(()=>t.active&&t.componentName==="SelectTemplate"),f=S(()=>t.title);function g(){t.data.store[t.data.storeProp].template_name?l.value=t.data.store[t.data.storeProp].template_name:l.value=t.data.templates[0]}async function x(){await t.data.store.setTemplate(l.value),!t.data.store.isEdit&&t.data.isMarkAsDefault&&(t.data.storeProp=="newEstimate"?await e.updateUserSettings({settings:{default_estimate_template:l.value}}):t.data.storeProp=="newInvoice"&&await e.updateUserSettings({settings:{default_invoice_template:l.value}})),y()}function j(){return"imgUrl"}function y(){t.closeModal(),setTimeout(()=>{t.$reset()},300)}return(E,D)=>{const k=_("BaseIcon"),d=_("BaseCheckbox"),r=_("BaseButton"),m=_("BaseModal");return i(),q(m,{show:o(w),onClose:y,onOpen:g},{header:c(()=>[n("div",Bs,[A(v(o(f))+" ",1),a(k,{name:"XIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:y})])]),default:c(()=>[n("div",Ps,[o(t).data?(i(),B("div",Is,[(i(!0),B(Q,null,ee(o(t).data.templates,(u,V)=>(i(),B("div",{key:V,class:Y([{"border border-solid border-gray-500":l.value===u.name},"relative flex flex-col m-2 border border-gray-200 border-solid cursor-pointer hover:border-gray-300"]),onClick:h=>l.value=u.name},[n("img",{src:u.path,alt:u.name,class:"w-full min-h-[100px]"},null,8,Ts),l.value===u.name?(i(),B("img",{key:0,alt:u.name,class:"absolute z-10 w-5 h-5 text-primary-500",style:{top:"-6px",right:"-5px"},src:j()},null,8,ks)):L("",!0),n("span",{class:Y(["w-full p-1 bg-gray-200 text-sm text-center absolute bottom-0 left-0",{"text-primary-500 bg-gray-100":l.value===u.name,"text-gray-600":l.value!=u.name}])},v(u.name),3)],10,Ss))),128))])):L("",!0),o(t).data.store.isEdit?L("",!0):(i(),B("div",Cs,[a(d,{modelValue:o(t).data.isMarkAsDefault,"onUpdate:modelValue":D[0]||(D[0]=u=>o(t).data.isMarkAsDefault=u),"set-initial-value":!1,variant:"primary",label:E.$t("general.mark_as_default"),description:o(t).data.markAsDefaultDescription},null,8,["modelValue","label","description"])]))]),n("div",Ms,[a(r,{class:"mr-3",variant:"primary-outline",onClick:y},{default:c(()=>[A(v(E.$t("general.cancel")),1)]),_:1}),a(r,{variant:"primary",onClick:D[1]||(D[1]=u=>x())},{left:c(u=>[a(k,{name:"SaveIcon",class:Y(u.class)},null,8,["class"])]),default:c(()=>[A(" "+v(E.$t("general.choose")),1)]),_:1})])]),_:1},8,["show"])}}},Ds={class:"flex justify-between w-full"},Vs={class:"item-modal"},js=["onSubmit"],qs={class:"px-8 py-8 sm:p-6"},Es={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},Qs={emits:["newItem"],setup(s,{emit:t}){const e=H(),l=xe(),w=se(),f=te();Ve(),je();const{t:g}=J(),x=F(!1),j=F(w.selectedCompanySettings.tax_per_item),y=S(()=>e.active&&e.componentName==="ItemModal"),E=S({get:()=>l.currentItem.price/100,set:h=>{l.currentItem.price=Math.round(h*100)}}),D=S({get:()=>l.currentItem.taxes.map(h=>{if(h)return{...h,tax_type_id:h.id,tax_name:h.name+" ("+h.percent+"%)"}}),set:h=>{l.$patch(T=>{T.currentItem.taxes=h})}}),k=S(()=>j.value==="YES"),d={name:{required:U.withMessage(g("validation.required"),X),minLength:U.withMessage(g("validation.name_min_length",{count:3}),qe(3))},description:{maxLength:U.withMessage(g("validation.description_maxlength",{count:255}),oe(255))}},r=re(d,S(()=>l.currentItem)),m=S(()=>f.taxTypes.map(h=>({...h,tax_name:h.name+" ("+h.percent+"%)"})));ge(()=>{r.value.$reset(),l.fetchItemUnits({limit:"all"})});async function u(){if(r.value.$touch(),r.value.$invalid)return!0;let h={...l.currentItem,taxes:l.currentItem.taxes.map(C=>({tax_type_id:C.id,amount:E.value*C.percent/100,percent:C.percent,name:C.name,collective_tax:0}))};x.value=!0,await(l.isEdit?l.updateItem:l.addItem)(h).then(C=>{x.value=!1,C.data.data&&e.data&&e.refreshData(C.data.data),V()})}function V(){e.closeModal(),setTimeout(()=>{l.resetCurrentItem(),e.$reset(),r.value.$reset()},300)}return(h,T)=>{const C=_("BaseIcon"),b=_("BaseInput"),$=_("BaseInputGroup"),M=_("BaseMoney"),O=_("BaseMultiselect"),W=_("BaseTextarea"),z=_("BaseInputGrid"),p=_("BaseButton"),P=_("BaseModal");return i(),q(P,{show:o(y),onClose:V},{header:c(()=>[n("div",Ds,[A(v(o(e).title)+" ",1),a(C,{name:"XIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:V})])]),default:c(()=>[n("div",Vs,[n("form",{action:"",onSubmit:he(u,["prevent"])},[n("div",qs,[a(z,{layout:"one-column"},{default:c(()=>[a($,{label:h.$t("items.name"),required:"",error:o(r).name.$error&&o(r).name.$errors[0].$message},{default:c(()=>[a(b,{modelValue:o(l).currentItem.name,"onUpdate:modelValue":T[0]||(T[0]=I=>o(l).currentItem.name=I),type:"text",invalid:o(r).name.$error,onInput:T[1]||(T[1]=I=>o(r).name.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"]),a($,{label:h.$t("items.price")},{default:c(()=>[a(M,{key:o(w).selectedCompanyCurrency,modelValue:o(E),"onUpdate:modelValue":T[2]||(T[2]=I=>Z(E)?E.value=I:null),currency:o(w).selectedCompanyCurrency,class:"relative w-full focus:border focus:border-solid focus:border-gray"},null,8,["modelValue","currency"])]),_:1},8,["label"]),a($,{label:h.$t("items.unit")},{default:c(()=>[a(O,{modelValue:o(l).currentItem.unit_id,"onUpdate:modelValue":T[3]||(T[3]=I=>o(l).currentItem.unit_id=I),label:"name",options:o(l).itemUnits,"value-prop":"id","can-deselect":!1,"can-clear":!1,placeholder:h.$t("items.select_a_unit"),searchable:"","track-by":"name"},null,8,["modelValue","options","placeholder"])]),_:1},8,["label"]),o(k)?(i(),q($,{key:0,label:h.$t("items.taxes")},{default:c(()=>[a(O,{modelValue:o(D),"onUpdate:modelValue":T[4]||(T[4]=I=>Z(D)?D.value=I:null),options:o(m),mode:"tags",label:"tax_name","value-prop":"id",class:"w-full","can-deselect":!1,"can-clear":!1,searchable:"","track-by":"tax_name",object:""},null,8,["modelValue","options"])]),_:1},8,["label"])):L("",!0),a($,{label:h.$t("items.description"),error:o(r).description.$error&&o(r).description.$errors[0].$message},{default:c(()=>[a(W,{modelValue:o(l).currentItem.description,"onUpdate:modelValue":T[5]||(T[5]=I=>o(l).currentItem.description=I),rows:"4",cols:"50",invalid:o(r).description.$error,onInput:T[6]||(T[6]=I=>o(r).description.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"])]),_:1})]),n("div",Es,[a(p,{class:"mr-3",variant:"primary-outline",type:"button",onClick:V},{default:c(()=>[A(v(h.$t("general.cancel")),1)]),_:1}),a(p,{loading:x.value,disabled:x.value,variant:"primary",type:"submit"},{left:c(I=>[a(C,{name:"SaveIcon",class:Y(I.class)},null,8,["class"])]),default:c(()=>[A(" "+v(o(l).isEdit?h.$t("general.update"):h.$t("general.save")),1)]),_:1},8,["loading","disabled"])])],40,js)])]),_:1},8,["show"])}}},As={class:"flex justify-between w-full"},Ls={class:"flex flex-col"},Os={class:"text-sm text-gray-500 mt-1"},zs=["onSubmit"],Us={class:"p-4 sm:p-6"},Ns={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},Fs={emits:["addTax"],setup(s,{emit:t}){const e=H();Ee();const l=fe({state:"",city:"",address_street_1:"",zip:""}),w=F(!1),f=te(),{t:g}=J(),x=S(()=>e.active&&e.componentName==="TaxationAddressModal"),j=S(()=>({state:{required:U.withMessage(g("validation.required"),X)},city:{required:U.withMessage(g("validation.required"),X)},address_street_1:{required:U.withMessage(g("validation.required"),X)},zip:{required:U.withMessage(g("validation.required"),X)}})),y=re(j,S(()=>l));async function E(){if(y.value.$touch(),y.value.$invalid)return!0;let d={address:l};e.id&&(d.customer_id=e.id),l.address_street_1=l.address_street_1.replace(/(\r\n|\n|\r)/gm,""),w.value=!0,await f.fetchSalesTax(d).then(r=>{w.value=!1,t("addTax",r.data.data),k()}).catch(r=>{w.value=!1})}function D(){var d,r,m,u;l.state=(d=e==null?void 0:e.data)==null?void 0:d.state,l.city=(r=e==null?void 0:e.data)==null?void 0:r.city,l.address_street_1=(m=e==null?void 0:e.data)==null?void 0:m.address_street_1,l.zip=(u=e==null?void 0:e.data)==null?void 0:u.zip}function k(){e.closeModal()}return(d,r)=>{const m=_("BaseIcon"),u=_("BaseInput"),V=_("BaseInputGroup"),h=_("BaseTextarea"),T=_("BaseInputGrid"),C=_("BaseButton"),b=_("BaseModal");return i(),q(b,{show:o(x),onClose:k,onOpen:D},{header:c(()=>[n("div",As,[n("div",Ls,[A(v(o(e).title)+" ",1),n("p",Os,v(o(e).content),1)]),a(m,{name:"XIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:k})])]),default:c(()=>[n("form",{onSubmit:he(E,["prevent"])},[n("div",Us,[a(T,{layout:"one-column"},{default:c(()=>[a(V,{required:"",error:o(y).state.$error&&o(y).state.$errors[0].$message,label:d.$t("customers.state")},{default:c(()=>[a(u,{modelValue:o(l).state,"onUpdate:modelValue":r[0]||(r[0]=$=>o(l).state=$),type:"text",name:"shippingState",class:"mt-1 md:mt-0",invalid:o(y).state.$error,onInput:r[1]||(r[1]=$=>o(y).state.$touch()),placeholder:d.$t("settings.taxations.state_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"]),a(V,{required:"",error:o(y).city.$error&&o(y).city.$errors[0].$message,label:d.$t("customers.city")},{default:c(()=>[a(u,{modelValue:o(l).city,"onUpdate:modelValue":r[2]||(r[2]=$=>o(l).city=$),type:"text",name:"shippingCity",class:"mt-1 md:mt-0",invalid:o(y).city.$error,onInput:r[3]||(r[3]=$=>o(y).city.$touch()),placeholder:d.$t("settings.taxations.city_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"]),a(V,{required:"",error:o(y).address_street_1.$error&&o(y).address_street_1.$errors[0].$message,label:d.$t("customers.address")},{default:c(()=>[a(h,{modelValue:o(l).address_street_1,"onUpdate:modelValue":r[4]||(r[4]=$=>o(l).address_street_1=$),rows:"2",cols:"50",class:"mt-1 md:mt-0",invalid:o(y).address_street_1.$error,onInput:r[5]||(r[5]=$=>o(y).address_street_1.$touch()),placeholder:d.$t("settings.taxations.address_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"]),a(V,{required:"",error:o(y).zip.$error&&o(y).zip.$errors[0].$message,label:d.$t("customers.zip_code")},{default:c(()=>[a(u,{modelValue:o(l).zip,"onUpdate:modelValue":r[6]||(r[6]=$=>o(l).zip=$),invalid:o(y).zip.$error,onInput:r[7]||(r[7]=$=>o(y).zip.$touch()),type:"text",class:"mt-1 md:mt-0",placeholder:d.$t("settings.taxations.zip_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"])]),_:1})]),n("div",Ns,[a(C,{class:"mr-3 text-sm",type:"button",variant:"primary-outline",onClick:k},{default:c(()=>[A(v(d.$t("general.cancel")),1)]),_:1}),a(C,{loading:w.value,variant:"primary",type:"submit"},{left:c($=>[w.value?L("",!0):(i(),q(m,{key:0,name:"SaveIcon",class:Y($.class)},null,8,["class"]))]),default:c(()=>[A(" "+v(d.$t("general.save")),1)]),_:1},8,["loading"])])],40,zs)]),_:1},8,["show"])}}},Zs={props:{isEdit:{type:Boolean,default:null},type:{type:String,default:null},customer:{type:[Object],default:null},store:{type:Object,default:null},storeProp:{type:String,default:null}},setup(s){const t=s,e="Sales Tax",l="MODULE",w=H(),f=se(),g=te(),{t:x}=J(),j=F(!1),y=S(()=>t.isEdit?t.store[t.storeProp].sales_tax_address_type==="billing":f.selectedCompanySettings.sales_tax_address_type==="billing"),E=S(()=>f.selectedCompanySettings.sales_tax_us_enabled==="YES"),D=S(()=>t.isEdit?t.store[t.storeProp].sales_tax_type==="customer_level":f.selectedCompanySettings.sales_tax_type==="customer_level"),k=S(()=>t.isEdit?t.store[t.storeProp].sales_tax_type==="company_level":f.selectedCompanySettings.sales_tax_type==="company_level"),d=S(()=>{if(D.value&&r.value){let b=y.value?t.customer.billing:t.customer.shipping;return{address:R.exports.pick(b,["address_street_1","city","state","zip"]),customer_id:t.customer.id}}else if(k.value&&r.value)return{address:R.exports.pick(address,["address_street_1","city","state","zip"])}}),r=S(()=>{var b,$;if(D.value){let M=y.value?(b=t.customer)==null?void 0:b.billing:($=t.customer)==null?void 0:$.shipping;return m(M)}else if(k.value)return m(f.selectedCompany.address);return!1});K(()=>t.customer,(b,$)=>{if(b&&$&&D.value){u(b,$);return}!r.value&&D.value&&b?setTimeout(()=>{V()},500):D.value&&b?h():D.value&&!b&&C()}),ge(()=>{k.value&&(r.value?h():V())});function m(b){return b?b.address_street_1&&b.city&&b.state&&b.zip:!1}function u(b,$){const M=y.value?b.billing:b.shipping,O=y.value?$.billing:$.shipping,W=R.exports.pick(M,["address_street_1","city","state","zip"]),z=R.exports.pick(O,["address_street_1","city","state","zip"]);R.exports.isEqual(W,z)||h()}function V(){var M,O;if(!E.value)return;let b=null,$="";D.value?y.value?(b=(M=t.customer)==null?void 0:M.billing,$=x("settings.taxations.add_billing_address")):(b=(O=t.customer)==null?void 0:O.shipping,$=x("settings.taxations.add_shipping_address")):(b=f.selectedCompany.address,$=x("settings.taxations.add_company_address")),w.openModal({title:$,content:x("settings.taxations.modal_description"),componentName:"TaxationAddressModal",data:b,id:D.value?t.customer.id:""})}async function h(){E.value&&(j.value=!0,await g.fetchSalesTax(d.value).then(b=>{T(b.data.data),j.value=!1}).catch(b=>{b.response.data.error&&setTimeout(()=>{V()},500),j.value=!1}))}function T(b){b.tax_type_id=b.id;const $=t.store[t.storeProp].taxes.findIndex(M=>M.name===e&&M.type===l);$>-1?Object.assign(t.store[t.storeProp].taxes[$],b):t.store[t.storeProp].taxes.push(b)}function C(){const b=t.store[t.storeProp].taxes.findIndex(M=>M.name===e&&M.type===l);b>-1&&t.store[t.storeProp].taxes.splice(b,1);let $=g.taxTypes.findIndex(M=>M.name===e&&M.type===l);$>-1&&g.taxTypes.splice($,1)}return(b,$)=>(i(),q(Fs,{onAddTax:T}))}};export{Ks as _,Qs as a,Zs as b,Rs as c,Js as d,Hs as e,Xs as f};
