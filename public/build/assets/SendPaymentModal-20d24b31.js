import{a6 as O,u as R,e as G,J as Q,f as Z,K as ee,D as H,a3 as te,r as d,o as i,n as y,w as o,m as e,a,O as k,q as c,t as b,I,c as z,C as ae,g as T,F as oe,l as F,h as M,i as j,j as Y,k as ne,b as P,H as re}from"./main-9a914193.js";import{u as W}from"./payment-0bb414a0.js";import{u as se}from"./mail-driver-c2eadad2.js";const le=c(" Mark FULFILLED "),_e={props:{row:{type:Object,default:null},table:{type:Object,default:null},refreshTable:Function,contentLoading:{type:Boolean,default:!1}},setup(w){const f=w,E=O(),_=R(),{t:h}=G(),g=W(),l=Q(),C=Z(),m=ee(),L=H(),s=te("utils");function A(t){E.openDialog({title:h("general.are_you_sure"),message:h("payments.confirm_delete",1),yesLabel:h("general.ok"),noLabel:h("general.cancel"),variant:"danger",size:"lg",hideNoButton:!1}).then(async p=>{if(p)return await g.deletePayment({ids:[t]}),C.push("/admin/payments"),f.table&&f.table.refresh(),!0})}function q(){var p;let t=`${window.location.origin}/payments/pdf/${(p=f.row)==null?void 0:p.unique_hash}`;s.copyTextToClipboard(t),_.showNotification({type:"success",message:h("general.copied_pdf_url_clipboard")})}async function N(){let t={...f.row};t.fulfilment="FULFILLED",f.contentLoading=!0,await g.updatePayment(t),f.contentLoading=!1,f.refreshTable()}async function U(t){L.openModal({title:h("payments.send_payment"),componentName:"SendPaymentModal",id:t.id,data:t,variant:"lg"})}return(t,p)=>{const v=d("BaseIcon"),V=d("BaseButton"),B=d("BaseDropdown-item"),r=d("BaseDropdownItem"),n=d("router-link"),$=d("BaseDropdown");return i(),y($,{"content-loading":w.contentLoading},{activator:o(()=>[e(l).name==="payments.view"?(i(),y(V,{key:0,variant:"primary"},{default:o(()=>[a(v,{name:"DotsHorizontalIcon",class:"h-5 text-white"})]),_:1})):(i(),y(v,{key:1,name:"DotsHorizontalIcon",class:"h-5 text-gray-500"}))]),default:o(()=>[e(l).name==="payments.view"&&e(m).hasAbilities(e(k).VIEW_PAYMENT)?(i(),y(B,{key:0,class:"rounded-md",onClick:q},{default:o(()=>[a(v,{name:"LinkIcon",class:"w-5 h-5 mr-3 text-gray-400 group-hover:text-gray-500"}),c(" "+b(t.$t("general.copy_pdf_url")),1)]),_:1})):I("",!0),e(m).hasAbilities(e(k).EDIT_PAYMENT)?(i(),y(n,{key:1,to:`/admin/payments/${w.row.id}/edit`},{default:o(()=>[a(r,null,{default:o(()=>[a(v,{name:"PencilIcon",class:"w-5 h-5 mr-3 text-gray-400 group-hover:text-gray-500"}),c(" "+b(t.$t("general.edit")),1)]),_:1})]),_:1},8,["to"])):I("",!0),e(m).hasAbilities(e(k).EDIT_PAYMENT)?(i(),z("a",{key:2,onClick:N},[a(r,null,{default:o(()=>[a(v,{name:"SaveIcon",class:"w-5 h-5 mr-3 text-gray-400 group-hover:text-gray-500"}),le]),_:1})])):I("",!0),e(l).name!=="payments.view"&&e(m).hasAbilities(e(k).VIEW_PAYMENT)?(i(),y(n,{key:3,to:`/admin/payments/${w.row.id}/view`},{default:o(()=>[a(r,null,{default:o(()=>[a(v,{name:"EyeIcon",class:"w-5 h-5 mr-3 text-gray-400 group-hover:text-gray-500"}),c(" "+b(t.$t("general.view")),1)]),_:1})]),_:1},8,["to"])):I("",!0),w.row.status!=="SENT"&&e(l).name!=="payments.view"&&e(m).hasAbilities(e(k).SEND_PAYMENT)?(i(),y(r,{key:4,onClick:p[0]||(p[0]=S=>U(w.row))},{default:o(()=>[a(v,{name:"PaperAirplaneIcon",class:"w-5 h-5 mr-3 text-gray-400 group-hover:text-gray-500"}),c(" "+b(t.$t("payments.send_payment")),1)]),_:1})):I("",!0),e(m).hasAbilities(e(k).DELETE_PAYMENT)?(i(),y(r,{key:5,onClick:p[1]||(p[1]=S=>A(w.row.id))},{default:o(()=>[a(v,{name:"TrashIcon",class:"w-5 h-5 mr-3 text-gray-400 group-hover:text-gray-500"}),c(" "+b(t.$t("general.delete")),1)]),_:1})):I("",!0)]),_:1},8,["content-loading"])}}},ie={class:"flex justify-between w-full"},ue={key:0,action:""},de={class:"px-8 py-8 sm:p-6"},me={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},ce={key:1},pe={class:"my-6 mx-4 border border-gray-200 relative"},ye=c(" Edit "),fe=["src"],ge={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},he={setup(w){const f=W(),E=ae(),_=H(),h=R();se(),O();const{t:g}=G();let l=T(!1);const C=T(""),m=T(!1),L=T(["customer","customerCustom","payments","paymentsCustom","company"]),s=oe({id:null,from:null,to:null,subject:"New Payment",body:null}),A=F(()=>_.active&&_.componentName==="SendPaymentModal"),q=F(()=>_.title),N=F(()=>_.data),U={from:{required:M.withMessage(g("validation.required"),j),email:M.withMessage(g("validation.email_incorrect"),Y)},to:{required:M.withMessage(g("validation.required"),j),email:M.withMessage(g("validation.email_incorrect"),Y)},subject:{required:M.withMessage(g("validation.required"),j)},body:{required:M.withMessage(g("validation.required"),j)}},t=ne(U,s);function p(){m.value=!1}async function v(){let r=await E.fetchBasicMailConfig();s.id=_.id,r.data&&(s.from=r.data.from_mail),N.value&&(s.to=N.value.customer.email),s.body=E.selectedCompanySettings.payment_mail_body}async function V(){if(t.value.$touch(),t.value.$invalid)return!0;try{if(l.value=!0,!m.value){const $=await f.previewPayment(s);l.value=!1,m.value=!0;var r=new Blob([$.data],{type:"text/html"});C.value=URL.createObjectURL(r);return}const n=await f.sendEmail(s);if(l.value=!1,n.data.success)return B(),!0}catch{l.value=!1,h.showNotification({type:"error",message:g("payments.something_went_wrong")})}}function B(){setTimeout(()=>{t.value.$reset(),m.value=!1,C.value=null,_.resetModalData()},300)}return(r,n)=>{const $=d("BaseIcon"),S=d("BaseInput"),x=d("BaseInputGroup"),J=d("BaseCustomInput"),K=d("BaseInputGrid"),D=d("BaseButton"),X=d("BaseModal");return i(),y(X,{show:e(A),onClose:B,onOpen:v},{header:o(()=>[P("div",ie,[c(b(e(q))+" ",1),a($,{name:"XIcon",class:"w-6 h-6 text-gray-500 cursor-pointer",onClick:B})])]),default:o(()=>[m.value?(i(),z("div",ce,[P("div",pe,[a(D,{class:"absolute top-4 right-4",disabled:e(l),variant:"primary-outline",onClick:p},{default:o(()=>[a($,{name:"PencilIcon",class:"h-5 mr-2"}),ye]),_:1},8,["disabled"]),P("iframe",{src:C.value,frameborder:"0",class:"w-full",style:{"min-height":"500px"}},null,8,fe)]),P("div",ge,[a(D,{class:"mr-3",variant:"primary-outline",type:"button",onClick:B},{default:o(()=>[c(b(r.$t("general.cancel")),1)]),_:1}),a(D,{loading:e(l),disabled:e(l),variant:"primary",type:"button",onClick:n[7]||(n[7]=u=>V())},{default:o(()=>[e(l)?I("",!0):(i(),y($,{key:0,name:"PaperAirplaneIcon",class:"h-5 mr-2"})),c(" "+b(r.$t("general.send")),1)]),_:1},8,["loading","disabled"])])])):(i(),z("form",ue,[P("div",de,[a(K,{layout:"one-column",class:"col-span-7"},{default:o(()=>[a(x,{label:r.$t("general.from"),required:"",error:e(t).from.$error&&e(t).from.$errors[0].$message},{default:o(()=>[a(S,{modelValue:e(s).from,"onUpdate:modelValue":n[0]||(n[0]=u=>e(s).from=u),type:"text",invalid:e(t).from.$error,onInput:n[1]||(n[1]=u=>e(t).from.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"]),a(x,{label:r.$t("general.to"),required:"",error:e(t).to.$error&&e(t).to.$errors[0].$message},{default:o(()=>[a(S,{modelValue:e(s).to,"onUpdate:modelValue":n[2]||(n[2]=u=>e(s).to=u),type:"text",invalid:e(t).to.$error,onInput:n[3]||(n[3]=u=>e(t).to.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"]),a(x,{error:e(t).subject.$error&&e(t).subject.$errors[0].$message,label:r.$t("general.subject"),required:""},{default:o(()=>[a(S,{modelValue:e(s).subject,"onUpdate:modelValue":n[4]||(n[4]=u=>e(s).subject=u),type:"text",invalid:e(t).subject.$error,onInput:n[5]||(n[5]=u=>e(t).subject.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["error","label"]),a(x,{label:r.$t("general.body"),error:e(t).body.$error&&e(t).body.$errors[0].$message,required:""},{default:o(()=>[a(J,{modelValue:e(s).body,"onUpdate:modelValue":n[6]||(n[6]=u=>e(s).body=u),fields:L.value},null,8,["modelValue","fields"])]),_:1},8,["label","error"])]),_:1})]),P("div",me,[a(D,{class:"mr-3",variant:"primary-outline",type:"button",onClick:B},{default:o(()=>[c(b(r.$t("general.cancel")),1)]),_:1}),a(D,{loading:e(l),disabled:e(l),variant:"primary",type:"button",class:"mr-3",onClick:V},{left:o(u=>[e(l)?I("",!0):(i(),y($,{key:0,class:re(u.class),name:"PhotographIcon"},null,8,["class"]))]),default:o(()=>[c(" "+b(r.$t("general.preview")),1)]),_:1},8,["loading","disabled"])])]))]),_:1},8,["show"])}}};export{he as _,_e as a};
