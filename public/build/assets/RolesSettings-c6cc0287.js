import{a2 as Y,v as C,aQ as Z,$ as L,u as V,a6 as ee,e as q,J as te,K as Q,D as T,a3 as se,r as b,o as _,n as D,w as u,m as d,a as f,q as k,t as v,I as P,g as z,l as j,h as U,i as J,G as ae,k as oe,b as g,c as E,M as K,L as O,H as X,s as ne,C as ie,a4 as le}from"./main-9a914193.js";const F=(I=!1)=>{const p=I?window.pinia.defineStore:Y,{global:e}=window.i18n;return C.interceptors.request.use(s=>(s.headers.Authorization=`Bearer ${localStorage.getItem("auth.token")}`,s)),p({id:"role",state:()=>({roles:[],allAbilities:[],selectedRoles:[],currentRole:{id:null,name:"",abilities:[]}}),getters:{isEdit:s=>!!s.currentRole.id,abilitiesList:s=>{let n=s.allAbilities.map(i=>({modelName:i.model?i.model.substring(i.model.lastIndexOf("\\")+1):"Common",disabled:!1,...i}));return Z.groupBy(n,"modelName")}},actions:{fetchRoles(s){return new Promise((n,i)=>{C.get("/api/v1/roles",{params:s}).then(t=>{this.roles=t.data.data,n(t)}).catch(t=>{L(t),i(t)})})},fetchRole(s){return new Promise((n,i)=>{C.get(`/api/v1/roles/${s}`).then(t=>{this.currentRole.name=t.data.data.name,this.currentRole.id=t.data.data.id,t.data.data.abilities.forEach(l=>{for(const c in this.abilitiesList)this.abilitiesList[c].forEach(y=>{y.ability===l.name&&this.currentRole.abilities.push(y)})}),n(t)}).catch(t=>{L(t),i(t)})})},addRole(s){const n=V();return new Promise((i,t)=>{C.post("/api/v1/roles",s).then(l=>{this.roles.push(l.data.role),n.showNotification({type:"success",message:e.t("settings.roles.created_message")}),i(l)}).catch(l=>{L(l),t(l)})})},updateRole(s){const n=V();return new Promise((i,t)=>{C.put(`/api/v1/roles/${s.id}`,s).then(l=>{if(l.data){let c=this.roles.findIndex(y=>y.id===l.data.data.id);this.roles[c]=s.role,n.showNotification({type:"success",message:e.t("settings.roles.updated_message")})}i(l)}).catch(l=>{L(l),t(l)})})},fetchAbilities(s){return new Promise((n,i)=>{this.allAbilities.length?n(this.allAbilities):C.get("/api/v1/abilities",{params:s}).then(t=>{this.allAbilities=t.data.abilities,n(t)}).catch(t=>{L(t),i(t)})})},deleteRole(s){const n=V();return new Promise((i,t)=>{C.delete(`/api/v1/roles/${s}`).then(l=>{let c=this.roles.findIndex(y=>y.id===s);this.roles.splice(c,1),n.showNotification({type:"success",message:e.t("settings.roles.deleted_message")}),i(l)}).catch(l=>{L(l),t(l)})})}}})()},re={props:{row:{type:Object,default:null},table:{type:Object,default:null},loadData:{type:Function,default:null}},setup(I){const p=I,e=ee();V();const{t:s}=q(),n=F(),i=te(),t=Q(),l=T();se("utils");async function c(B){Promise.all([await n.fetchAbilities(),await n.fetchRole(B)]).then(()=>{l.openModal({title:s("settings.roles.edit_role"),componentName:"RolesModal",size:"lg",refreshData:p.loadData})})}async function y(B){e.openDialog({title:s("general.are_you_sure"),message:s("settings.roles.confirm_delete"),yesLabel:s("general.ok"),noLabel:s("general.cancel"),variant:"danger",hideNoButton:!1,size:"lg"}).then(async h=>{h&&await n.deleteRole(B).then(x=>{x.data&&p.loadData&&p.loadData()})})}return(B,h)=>{const x=b("BaseIcon"),w=b("BaseButton"),a=b("BaseDropdownItem"),r=b("BaseDropdown");return _(),D(r,null,{activator:u(()=>[d(i).name==="roles.view"?(_(),D(w,{key:0,variant:"primary"},{default:u(()=>[f(x,{name:"DotsHorizontalIcon",class:"h-5 text-white"})]),_:1})):(_(),D(x,{key:1,name:"DotsHorizontalIcon",class:"h-5 text-gray-500"}))]),default:u(()=>[d(t).currentUser.is_owner?(_(),D(a,{key:0,onClick:h[0]||(h[0]=m=>c(I.row.id))},{default:u(()=>[f(x,{name:"PencilIcon",class:"w-5 h-5 mr-3 text-gray-400 group-hover:text-gray-500"}),k(" "+v(B.$t("general.edit")),1)]),_:1})):P("",!0),d(t).currentUser.is_owner?(_(),D(a,{key:1,onClick:h[1]||(h[1]=m=>y(I.row.id))},{default:u(()=>[f(x,{name:"TrashIcon",class:"w-5 h-5 mr-3 text-gray-400 group-hover:text-gray-500"}),k(" "+v(B.$t("general.delete")),1)]),_:1})):P("",!0)]),_:1})}}},de={class:"flex justify-between w-full"},ce=["onSubmit"],ue={class:"px-4 md:px-8 py-4 md:py-6"},me={class:"flex justify-between"},fe={class:"text-sm not-italic font-medium text-gray-800 px-4 md:px-8 py-1.5"},pe=g("span",{class:"text-sm text-red-500"}," *",-1),he={class:"text-sm not-italic font-medium text-gray-300 px-4 md:px-8 py-1.5"},be=k(" / "),ge={class:"border-t border-gray-200 py-3"},_e={class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 px-8 sm:px-8"},ye={class:"text-sm text-gray-500 border-b border-gray-200 pb-1 mb-2"},ve={key:0,class:"block mt-0.5 text-sm text-red-500"},we={class:"z-0 flex justify-end p-4 border-t border-solid border--200 border-modal-bg"},Be={setup(I){const p=T(),e=F(),{t:s}=q();let n=z(!1),i=z(!1);const t=j(()=>p.active&&p.componentName==="RolesModal"),l=j(()=>({name:{required:U.withMessage(s("validation.required"),J),minLength:U.withMessage(s("validation.name_min_length",{count:3}),ae(3))},abilities:{required:U.withMessage(s("validation.at_least_one_ability"),J)}})),c=oe(l,j(()=>e.currentRole));async function y(){if(c.value.$touch(),c.value.$invalid)return!0;try{const a=e.isEdit?e.updateRole:e.addRole;n.value=!0,await a(e.currentRole),n.value=!1,p.refreshData&&p.refreshData(),w()}catch{return n.value=!1,!0}}function B(a){var m,o;if(!e.currentRole.abilities.find(R=>R.ability===a.ability)&&((m=a==null?void 0:a.depends_on)!=null&&m.length)){x(a);return}(o=a==null?void 0:a.depends_on)==null||o.forEach(R=>{Object.keys(e.abilitiesList).forEach(M=>{e.abilitiesList[M].forEach(S=>{R===S.ability&&(S.disabled=!0,e.currentRole.abilities.find($=>$.ability===R)||e.currentRole.abilities.push(S))})})})}function h(a){let r=[];Object.keys(e.abilitiesList).forEach(m=>{e.abilitiesList[m].forEach(o=>{o!=null&&o.depends_on&&(r=[...r,...o.depends_on])})}),Object.keys(e.abilitiesList).forEach(m=>{e.abilitiesList[m].forEach(o=>{r.includes(o.ability)&&(a?o.disabled=!0:o.disabled=!1),e.currentRole.abilities.push(o)})}),a||(e.currentRole.abilities=[])}function x(a){a.depends_on.forEach(r=>{Object.keys(e.abilitiesList).forEach(m=>{e.abilitiesList[m].forEach(o=>{let R=e.currentRole.abilities.find(M=>{var S;return(S=M.depends_on)==null?void 0:S.includes(o.ability)});r===o.ability&&!R&&(o.disabled=!1)})})})}function w(){p.closeModal(),setTimeout(()=>{e.currentRole={id:null,name:"",abilities:[]},Object.keys(e.abilitiesList).forEach(a=>{e.abilitiesList[a].forEach(r=>{r.disabled=!1})}),c.value.$reset()},300)}return(a,r)=>{const m=b("BaseIcon"),o=b("BaseInput"),R=b("BaseInputGroup"),M=b("BaseCheckbox"),S=b("BaseButton"),G=b("BaseModal");return _(),D(G,{show:d(t),onClose:w},{header:u(()=>[g("div",de,[k(v(d(p).title)+" ",1),f(m,{name:"XIcon",class:"w-6 h-6 text-gray-500 cursor-pointer",onClick:w})])]),default:u(()=>[g("form",{onSubmit:ne(y,["prevent"])},[g("div",ue,[f(R,{label:a.$t("settings.roles.name"),class:"mt-3",error:d(c).name.$error&&d(c).name.$errors[0].$message,required:"","content-loading":d(i)},{default:u(()=>[f(o,{modelValue:d(e).currentRole.name,"onUpdate:modelValue":r[0]||(r[0]=$=>d(e).currentRole.name=$),invalid:d(c).name.$error,type:"text","content-loading":d(i),onInput:r[1]||(r[1]=$=>d(c).name.$touch())},null,8,["modelValue","invalid","content-loading"])]),_:1},8,["label","error","content-loading"])]),g("div",me,[g("h6",fe,[k(v(a.$t("settings.roles.permission",2))+" ",1),pe]),g("div",he,[g("a",{class:"cursor-pointer text-primary-400",onClick:r[2]||(r[2]=$=>h(!0))},v(a.$t("settings.roles.select_all")),1),be,g("a",{class:"cursor-pointer text-primary-400",onClick:r[3]||(r[3]=$=>h(!1))},v(a.$t("settings.roles.none")),1)])]),g("div",ge,[g("div",_e,[(_(!0),E(O,null,K(d(e).abilitiesList,($,H)=>(_(),E("div",{key:H,class:"flex flex-col space-y-1"},[g("p",ye,v(H),1),(_(!0),E(O,null,K($,(N,W)=>(_(),E("div",{key:W,class:"flex"},[f(M,{modelValue:d(e).currentRole.abilities,"onUpdate:modelValue":[r[4]||(r[4]=A=>d(e).currentRole.abilities=A),A=>B(N)],"set-initial-value":!0,variant:"primary",disabled:N.disabled,label:N.name,value:N},null,8,["modelValue","disabled","label","value","onUpdate:modelValue"])]))),128))]))),128)),d(c).abilities.$error?(_(),E("span",ve,v(d(c).abilities.$errors[0].$message),1)):P("",!0)])]),g("div",we,[f(S,{class:"mr-3 text-sm",variant:"primary-outline",type:"button",onClick:w},{default:u(()=>[k(v(a.$t("general.cancel")),1)]),_:1}),f(S,{loading:d(n),disabled:d(n),variant:"primary",type:"submit"},{left:u($=>[f(m,{name:"SaveIcon",class:X($.class)},null,8,["class"])]),default:u(()=>[k(" "+v(d(e).isEdit?a.$t("general.update"):a.$t("general.save")),1)]),_:1},8,["loading","disabled"])])],40,ce)]),_:1},8,["show"])}}},Re={setup(I){const p=T(),e=F(),s=Q(),n=ie(),{t:i}=q(),t=z(null),l=j(()=>[{key:"name",label:i("settings.roles.role_name"),thClass:"extra",tdClass:"font-medium text-gray-900"},{key:"created_at",label:i("settings.roles.added_on"),tdClass:"font-medium text-gray-900"},{key:"actions",label:"",tdClass:"text-right text-sm font-medium",sortable:!1}]);async function c({page:h,filter:x,sort:w}){let a={orderByField:w.fieldName||"created_at",orderBy:w.order||"desc",company_id:n.selectedCompany.id};return{data:(await e.fetchRoles(a)).data.data}}async function y(){t.value&&t.value.refresh()}async function B(){await e.fetchAbilities(),p.openModal({title:i("settings.roles.add_role"),componentName:"RolesModal",size:"lg",refreshData:t.value&&t.value.refresh})}return(h,x)=>{const w=b("BaseIcon"),a=b("BaseButton"),r=b("BaseTable"),m=b("BaseSettingCard");return _(),E(O,null,[f(Be),f(m,{title:h.$t("settings.roles.title"),description:h.$t("settings.roles.description")},le({default:u(()=>[f(r,{ref:(o,R)=>{R.table=o,t.value=o},data:c,columns:d(l),class:"mt-14"},{"cell-created_at":u(({row:o})=>[k(v(o.data.formatted_created_at),1)]),"cell-actions":u(({row:o})=>[d(s).currentUser.is_owner&&o.data.name!=="super admin"?(_(),D(re,{key:0,row:o.data,table:t.value,"load-data":y},null,8,["row","table"])):P("",!0)]),_:1},8,["columns"])]),_:2},[d(s).currentUser.is_owner?{name:"action",fn:u(()=>[f(a,{variant:"primary-outline",onClick:B},{left:u(o=>[f(w,{name:"PlusIcon",class:X(o.class)},null,8,["class"])]),default:u(()=>[k(" "+v(h.$t("settings.roles.add_new_role")),1)]),_:1})])}:void 0]),1032,["title","description"])],64)}}};export{Re as default};
