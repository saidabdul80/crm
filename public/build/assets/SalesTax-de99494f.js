import{aF as oe,D as H,K as re,g as F,F as _e,a3 as le,e as J,l as S,A as K,r as g,o as i,c as $,b as n,t as v,a,a4 as Ie,m as o,w as m,q as A,n as q,I as L,C as ae,aE as ge,J as Se,N as R,h as z,i as X,aX as Pe,au as ne,aV as Te,k as ie,p as te,L as Q,M as se,O as de,aZ as ke,az as he,al as Ce,a_ as Me,H as Y,T as De,a$ as Ve,b0 as je,aD as qe,u as Ee,G as Ae,W as ve,s as be,E as Le}from"./main-9a914193.js";import{D as Oe,d as ze}from"./DragIcon-0725a09c.js";import{_ as Ue}from"./SelectNotePopup-65fee220.js";const Ne={class:"flex items-center justify-between mb-3"},Fe={class:"flex items-center text-base",style:{flex:"4"}},We={class:"pr-2 mb-0",align:"right"},Ge={class:"absolute left-3.5"},Ye={class:"ml-2 text-sm leading-none cursor-pointer text-primary-400"},Re=n("br",null,null,-1),Xe={class:"text-sm text-right",style:{flex:"3"}},He={class:"flex items-center justify-center w-6 h-10 mx-2 cursor-pointer"},Je={props:{ability:{type:String,default:""},store:{type:Object,default:null},storeProp:{type:String,default:""},itemIndex:{type:Number,required:!0},index:{type:Number,required:!0},taxData:{type:Object,required:!0},taxes:{type:Array,default:[]},total:{type:Number,default:0},totalTax:{type:Number,default:0},discountedTotal:{type:Number,default:0},currency:{type:[Object,String],required:!0},updateItems:{type:Function,default:()=>{}}},emits:["remove","update"],setup(s,{emit:t}){const e=s,r=oe(),B=H(),w=re(),_=F(null),y=_e({...e.taxData});le("utils");const{t:D}=J(),f=S(()=>r.taxTypes.map(d=>({...d})).map(d=>(e.taxes.find(h=>h.tax_type_id===d.id)?d.disabled=!0:d.disabled=!1,d))),V=S(()=>y.compound_tax&&e.discountedTotal?(e.discountedTotal+e.totalTax)*y.percent/100:e.discountedTotal&&y.percent?e.discountedTotal*y.percent/100:0);K(()=>e.discountedTotal,()=>{P()}),K(()=>e.totalTax,()=>{P()}),e.taxData.tax_type_id>0&&(_.value=r.taxTypes.find(p=>p.id===e.taxData.tax_type_id)),P();function j(p){y.percent=p.percent,y.tax_type_id=p.id,y.compound_tax=p.compound_tax,y.name=p.name,P()}function P(){y.tax_type_id!==0&&t("update",{index:e.index,item:{...y,amount:V.value}})}function u(){let p={itemIndex:e.itemIndex,taxIndex:e.index};B.openModal({title:D("settings.tax_types.add_tax"),componentName:"TaxTypeModal",data:p,size:"sm"})}function l(p){e.store.$patch(d=>{d[e.storeProp].items[e.itemIndex].taxes.splice(p,1)})}return(p,d)=>{const M=g("BaseIcon"),h=g("BaseMultiselect"),C=g("BaseFormatMoney");return i(),$("div",Ne,[n("div",Fe,[n("label",We,v(p.$t("invoices.item.tax")),1),a(h,{modelValue:_.value,"onUpdate:modelValue":[d[0]||(d[0]=T=>_.value=T),d[1]||(d[1]=T=>j(T))],"value-prop":"id",options:o(f),placeholder:p.$t("general.select_a_tax"),"open-direction":"top","track-by":"name",searchable:"",object:"",label:"name"},Ie({singlelabel:m(({value:T})=>[n("div",Ge,v(T.name)+" - "+v(T.percent)+" % ",1)]),option:m(({option:T})=>[A(v(T.name)+" - "+v(T.percent)+" % ",1)]),_:2},[o(w).hasAbilities(s.ability)?{name:"action",fn:m(()=>[n("button",{type:"button",class:"flex items-center justify-center w-full px-2 py-2 bg-gray-200 border-none outline-none cursor-pointer",onClick:u},[a(M,{name:"CheckCircleIcon",class:"h-5 text-primary-400"}),n("label",Ye,v(p.$t("invoices.add_new_tax")),1)])])}:void 0]),1032,["modelValue","options","placeholder"]),Re]),n("div",Xe,[a(C,{amount:o(V),currency:s.currency},null,8,["amount","currency"])]),n("div",He,[s.taxes.length&&s.index!==s.taxes.length-1?(i(),q(M,{key:0,name:"TrashIcon",class:"h-5 text-gray-700 cursor-pointer",onClick:d[2]||(d[2]=T=>l(s.index))})):L("",!0)])])}}},Ke={class:"box-border bg-white border border-gray-200 border-solid rounded-b"},Qe={colspan:"5",class:"p-0 text-left align-top"},Ze={class:"w-full"},et=n("col",{style:{width:"40%","min-width":"280px"}},null,-1),tt=n("col",{style:{width:"10%","min-width":"120px"}},null,-1),st=n("col",{style:{width:"15%","min-width":"120px"}},null,-1),ot={key:0,style:{width:"15%","min-width":"160px"}},at=n("col",{style:{width:"15%","min-width":"120px"}},null,-1),nt={class:"px-5 py-4 text-left align-top"},rt={class:"flex justify-start"},lt={class:"flex items-center justify-center w-5 h-5 mt-2 mr-2 text-gray-300 cursor-move handle"},it={class:"px-5 py-4 text-right align-top flex items-center"},dt={class:"bg="},ct={class:"px-5 py-4 text-left align-top"},ut={class:"flex flex-col"},mt={class:"flex-auto flex-fill bd-highlight"},pt={class:"relative w-full"},yt={key:0,class:"px-5 py-4 text-left align-top"},ft={class:"flex flex-col"},xt={class:"flex",style:{width:"120px"},role:"group"},_t={class:"flex items-center"},gt={class:"px-5 py-4 text-right align-top"},ht={class:"flex items-center justify-end text-sm"},vt={class:"flex items-center"},bt={class:"flex items-center justify-center w-6 h-10 mx-2"},$t={key:0},wt=n("td",{class:"px-5 py-4 text-left align-top"},null,-1),Bt={colspan:"4",class:"px-5 py-4 text-left align-top"},It={props:{store:{type:Object,default:null},storeProp:{type:String,default:""},itemData:{type:Object,default:null},index:{type:Number,default:null},type:{type:String,default:""},loading:{type:Boolean,default:!1},currency:{type:[Object,String],required:!0},invoiceItems:{type:Array,required:!0},itemValidationScope:{type:String,default:""}},emits:["update","remove","itemValidate"],setup(s,{emit:t}){const e=s,r=ae(),B=ge();Se();const{t:w}=J(),_=F(0),y=S({get:()=>e.itemData.quantity,set:c=>{U("quantity",parseFloat(c))}}),D=F(0),f=S(()=>e.itemData.price*e.itemData.quantity),V=S({get:()=>e.itemData.discount,set:c=>{e.itemData.discount_type==="percentage"?U("discount_val",f.value*c):U("discount_val",Math.round(c)),U("discount",c)}}),j=S(()=>e.currency?e.currency:r.selectedCompanyCurrency),P=S(()=>e.store[e.storeProp].items.length!=1),u=S(()=>Math.round(R.exports.sumBy(e.itemData.taxes,function(c){return c.compound_tax?0:c.amount}))),l=S(()=>Math.round(R.exports.sumBy(e.itemData.taxes,function(c){return c.compound_tax?c.amount:0}))),p=S(()=>u.value+l.value),d=F(!1),M=function(){var I,E;const c=(I=e.store[e.storeProp])==null?void 0:I.exchange_rate;c?(D.value=c,(E=e.store[e.storeProp])!=null&&E.fliped?_.value=(y.value*c).toFixed(2)-e.itemData.discount_val:_.value=(y.value/c).toFixed(2)-e.itemData.discount_val):_.value=0,setTimeout(()=>{d.value=!1},500)},h=function(){var I,E;const c=(I=e.store[e.storeProp])==null?void 0:I.exchange_rate;c?(D.value=c,(E=e.store[e.storeProp])!=null&&E.fliped?_.value=(y.value/c).toFixed(2)-e.itemData.discount_val:_.value=(y.value*c).toFixed(2)-e.itemData.discount_val):_.value=0,setTimeout(()=>{d.value=!1},500)},C=function(){var I,E;const c=(I=e.store[e.storeProp])==null?void 0:I.exchange_rate;c?(D.value=c,(E=e.store[e.storeProp])!=null&&E.fliped?y.value=(_.value/c).toFixed(2):y.value=(_.value*c).toFixed(2)):_.value=0,setTimeout(()=>{d.value=!1},500)};K(()=>e.store[e.storeProp],(c,I)=>{d.value||(M(),d.value=!0)},{deep:!0,immediate:!0}),K(()=>y.value,(c,I)=>{d.value||(h(),d.value=!0)},{immediate:!0,shallow:!0}),K(()=>_.value,(c,I)=>{d.value||(C(),d.value=!0)},{immediate:!0,shallow:!0});const T={name:{required:z.withMessage(w("validation.required"),X)},quantity:{required:z.withMessage(w("validation.required"),X),minValue:z.withMessage(w("validation.qty_must_greater_than_zero"),Pe(0)),maxLength:z.withMessage(w("validation.amount_maxlength"),ne(20))},discount_val:{between:z.withMessage(w("validation.discount_maxlength"),Te(0,S(()=>f.value)))},description:{maxLength:z.withMessage(w("validation.notes_maxlength"),ne(65e3))}},x=ie(T,S(()=>e.store[e.storeProp].items[e.index]),{$scope:e.itemValidationScope});function b(c){e.store.$patch(E=>{E[e.storeProp].items[e.index].taxes[c.index]=c.item});let I=e.itemData.taxes[e.itemData.taxes.length-1];(I==null?void 0:I.tax_type_id)!==0&&e.store.$patch(E=>{E[e.storeProp].items[e.index].taxes.push({...ke,id:he.raw()})}),W()}function k(c){U("name",c)}function O(c){e.store.$patch(I=>{if(I[e.storeProp].items[e.index].name=c.name,I[e.storeProp].items[e.index].price=c.price,I[e.storeProp].items[e.index].item_id=c.id,I[e.storeProp].items[e.index].description=c.description,c.unit&&(I[e.storeProp].items[e.index].unit_name=c.unit.name),e.store[e.storeProp].tax_per_item==="YES"&&c.taxes){let E=0;c.taxes.forEach(G=>{b({index:E,item:{...G}}),E++})}}),B.fetchItems(),W()}function Z(){e.itemData.discount_type!=="fixed"&&(U("discount_val",Math.round(e.itemData.discount)),U("discount_type","fixed"))}function ee(){e.itemData.discount_type!=="percentage"&&(U("discount_val",f.value*e.itemData.discount/100),U("discount_type","percentage"))}function W(){var E,G;let c=(G=(E=e.store[e.storeProp])==null?void 0:E.items[e.index])==null?void 0:G.taxes;c||(c=[]);let I={...e.store[e.storeProp].items[e.index],index:e.index,total:_.value,sub_total:f.value,totalSimpleTax:u.value,totalCompoundTax:l.value,totalTax:p.value,tax:p.value,taxes:[...c]};e.store.updateItem(I)}function U(c,I){e.store.$patch(E=>{E[e.storeProp].items[e.index][c]=I}),W()}return(c,I)=>{var ye,fe,xe;const E=g("BaseItemSelect"),G=g("BaseInput"),ce=g("BaseIcon"),$e=g("BaseButton"),ue=g("BaseDropdownItem"),we=g("BaseDropdown"),me=g("BaseContentPlaceholdersText"),pe=g("BaseContentPlaceholders");return i(),$("tr",Ke,[n("td",Qe,[n("table",Ze,[n("colgroup",null,[et,tt,st,s.store[s.storeProp].discount_per_item==="YES"?(i(),$("col",ot)):L("",!0),at]),n("tbody",null,[n("tr",null,[n("td",nt,[n("div",rt,[n("div",lt,[a(Oe)]),a(E,{type:"Invoice",item:s.itemData,invalid:o(x).name.$error,"invalid-description":o(x).description.$error,taxes:s.itemData.taxes,index:s.index,"store-prop":s.storeProp,store:s.store,onSearch:k,onSelect:O},null,8,["item","invalid","invalid-description","taxes","index","store-prop","store"])])]),n("td",it,[n("div",dt,v((fe=(ye=s.store[s.storeProp])==null?void 0:ye.from_currency)==null?void 0:fe.symbol),1),a(G,{modelValue:o(y),"onUpdate:modelValue":I[0]||(I[0]=N=>te(y)?y.value=N:null),invalid:o(x).quantity.$error,"content-loading":s.loading,type:"number",small:"",min:"0",step:"any",onChange:I[1]||(I[1]=N=>W()),onInput:I[2]||(I[2]=N=>o(x).quantity.$touch())},null,8,["modelValue","invalid","content-loading"])]),n("td",ct,[n("div",ut,[n("div",mt,[n("div",pt,v(D.value),1)])])]),s.store[s.storeProp].discount_per_item==="YES"?(i(),$("td",yt,[n("div",ft,[n("div",xt,[a(G,{modelValue:o(V),"onUpdate:modelValue":I[3]||(I[3]=N=>te(V)?V.value=N:null),invalid:o(x).discount_val.$error,"content-loading":s.loading,class:"border-r-0 focus:border-r-2 rounded-tr-sm rounded-br-sm h-[38px]"},null,8,["modelValue","invalid","content-loading"]),a(we,{position:"bottom-end"},{activator:m(()=>[a($e,{"content-loading":s.loading,class:"rounded-tr-md rounded-br-md !p-2 rounded-none",type:"button",variant:"white"},{default:m(()=>[n("span",_t,[A(v(s.itemData.discount_type=="fixed"?s.currency.symbol:"%")+" ",1),a(ce,{name:"ChevronDownIcon",class:"w-4 h-4 ml-1 text-gray-500"})])]),_:1},8,["content-loading"])]),default:m(()=>[a(ue,{onClick:Z},{default:m(()=>[A(v(c.$t("general.fixed")),1)]),_:1}),a(ue,{onClick:ee},{default:m(()=>[A(v(c.$t("general.percentage")),1)]),_:1})]),_:1})])])])):L("",!0),n("td",gt,[n("div",ht,[n("span",null,[s.loading?(i(),q(pe,{key:0},{default:m(()=>[a(me,{lines:1,class:"w-16 h-5"})]),_:1})):L("",!0),n("div",vt,[A(v((xe=o(j))==null?void 0:xe.symbol)+" ",1),a(G,{modelValue:_.value,"onUpdate:modelValue":I[4]||(I[4]=N=>_.value=N),invalid:o(x).discount_val.$error,"content-loading":s.loading,class:"border-r-0 focus:border-r-2 rounded-tr-sm rounded-l-sm h-[38px]"},null,8,["modelValue","invalid","content-loading"])])]),n("div",bt,[o(P)?(i(),q(ce,{key:0,class:"h-5 text-gray-700 cursor-pointer",name:"TrashIcon",onClick:I[5]||(I[5]=N=>s.store.removeItem(s.index))})):L("",!0)])])])]),s.store[s.storeProp].tax_per_item==="YES"?(i(),$("tr",$t,[wt,n("td",Bt,[s.loading?(i(),q(pe,{key:0},{default:m(()=>[a(me,{lines:1,class:"w-24 h-8 border rounded-md"})]),_:1})):(i(!0),$(Q,{key:1},se(s.itemData.taxes,(N,Be)=>(i(),q(Je,{key:N.id,index:Be,"item-index":s.index,"tax-data":N,taxes:s.itemData.taxes,"discounted-total":_.value,"total-tax":o(u),total:o(f),currency:s.currency,"update-items":W,ability:o(de).CREATE_INVOICE,store:s.store,"store-prop":s.storeProp,discount:o(V),onUpdate:b},null,8,["index","item-index","tax-data","taxes","discounted-total","total-tax","total","currency","ability","store","store-prop","discount"]))),128))])])):L("",!0)])])])])}}},St={class:"text-center item-table min-w-full"},Pt=n("col",{style:{width:"40%","min-width":"280px"}},null,-1),Tt=n("col",{style:{width:"10%","min-width":"120px"}},null,-1),kt=n("col",{style:{width:"15%","min-width":"120px"}},null,-1),Ct={key:0,style:{width:"15%","min-width":"160px"}},Mt=n("col",{style:{width:"15%","min-width":"120px"}},null,-1),Dt={class:"bg-white border border-gray-200 border-solid"},Vt={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},jt={key:1,class:"pl-7"},qt={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-right text-gray-700 border-t border-b border-gray-200 border-solid"},Et={key:1},At={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},Lt={key:1},Ot={key:0,class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},zt={key:1},Ut={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-right text-gray-700 border-t border-b border-gray-200 border-solid"},Nt={key:1,class:"pr-10 column-heading"},Hs={props:{store:{type:Object,default:null},storeProp:{type:String,default:""},currency:{type:[Object,String,null],required:!0},isLoading:{type:Boolean,default:!1},itemValidationScope:{type:String,default:""}},setup(s){const t=s,e=ae(),r=S(()=>t.currency?t.currency:e.selectedCompanyCurrency);return(B,w)=>{const _=g("BaseContentPlaceholdersText"),y=g("BaseContentPlaceholders"),D=g("BaseIcon");return i(),$(Q,null,[n("table",St,[n("colgroup",null,[Pt,Tt,kt,s.store[s.storeProp].discount_per_item==="YES"?(i(),$("col",Ct)):L("",!0),Mt]),n("thead",Dt,[n("tr",null,[n("th",Vt,[s.isLoading?(i(),q(y,{key:0},{default:m(()=>[a(_,{lines:1,class:"w-16 h-5"})]),_:1})):(i(),$("span",jt,v(B.$t("items.item",2)),1))]),n("th",qt,[s.isLoading?(i(),q(y,{key:0},{default:m(()=>[a(_,{lines:1,class:"w-16 h-5"})]),_:1})):(i(),$("span",Et,v(B.$t("invoices.item.quantity")),1))]),n("th",At,[s.isLoading?(i(),q(y,{key:0},{default:m(()=>[a(_,{lines:1,class:"w-16 h-5"})]),_:1})):(i(),$("span",Lt," Rate "))]),s.store[s.storeProp].discount_per_item==="YES"?(i(),$("th",Ot,[s.isLoading?(i(),q(y,{key:0},{default:m(()=>[a(_,{lines:1,class:"w-16 h-5"})]),_:1})):(i(),$("span",zt,v(B.$t("invoices.item.discount")),1))])):L("",!0),n("th",Ut,[s.isLoading?(i(),q(y,{key:0},{default:m(()=>[a(_,{lines:1,class:"w-16 h-5"})]),_:1})):(i(),$("span",Nt,v(B.$t("invoices.item.amount")),1))])])]),a(o(ze),{modelValue:s.store[s.storeProp].items,"onUpdate:modelValue":w[0]||(w[0]=f=>s.store[s.storeProp].items=f),"item-key":"id",tag:"tbody",handle:".handle"},{item:m(({element:f,index:V})=>[a(It,{key:f.id,index:V,"item-data":f,loading:s.isLoading,currency:o(r),"item-validation-scope":s.itemValidationScope,"invoice-items":s.store[s.storeProp].items,store:s.store,"store-prop":s.storeProp},null,8,["index","item-data","loading","currency","item-validation-scope","invoice-items","store","store-prop"])]),_:1},8,["modelValue"])]),n("div",{class:"flex items-center justify-center w-full px-6 py-3 text-base border border-t-0 border-gray-200 border-solid cursor-pointer text-primary-400 hoverbg-gray-100",onClick:w[1]||(w[1]=(...f)=>s.store.addItem&&s.store.addItem(...f))},[a(D,{name:"PlusCircleIcon",class:"mr-2"}),A(" "+v(B.$t("general.add_new_item")),1)])],64)}}},Ft={class:"flex items-center justify-between w-full mt-2 text-sm"},Wt={class:"font-semibold leading-5 text-gray-500 uppercase"},Gt={class:"flex items-center justify-center text-lg text-black"},Yt={props:{index:{type:Number,required:!0},tax:{type:Object,required:!0},taxes:{type:Array,required:!0},currency:{type:[Object,String],required:!0},store:{type:Object,default:null},data:{type:String,default:""}},emits:["update","remove"],setup(s,{emit:t}){const e=s;le("$utils");const r=S(()=>e.tax.compound_tax&&e.store.getSubtotalWithDiscount?Math.round((e.store.getSubtotalWithDiscount+e.store.getTotalSimpleTax)*e.tax.percent/100):e.store.getSubtotalWithDiscount&&e.tax.percent?Math.round(e.store.getSubtotalWithDiscount*e.tax.percent/100):0);Ce(()=>{e.store.getSubtotalWithDiscount&&B(),e.store.getTotalSimpleTax&&B()});function B(){t("update",{...e.tax,amount:r.value})}return(w,_)=>{const y=g("BaseFormatMoney"),D=g("BaseIcon");return i(),$("div",Ft,[n("label",Wt,v(s.tax.name)+" ("+v(s.tax.percent)+" %) ",1),n("label",Gt,[a(y,{amount:s.tax.amount,currency:s.currency},null,8,["amount","currency"]),a(D,{name:"TrashIcon",class:"h-5 ml-2 cursor-pointer",onClick:_[0]||(_[0]=f=>w.$emit("remove",s.tax.id))})])])}}},Rt={class:"w-full mt-4 tax-select"},Xt={class:"relative w-full max-w-md px-4"},Ht={class:"overflow-hidden rounded-md shadow-lg ring-1 ring-black ring-opacity-5"},Jt={class:"relative bg-white"},Kt={class:"relative p-4"},Qt={key:0,class:"relative flex flex-col overflow-auto list max-h-36 border-t border-gray-200"},Zt=["onClick"],es={class:"flex justify-between px-2"},ts={class:"m-0 text-base font-semibold leading-tight text-gray-700 cursor-pointer"},ss={class:"m-0 text-base font-semibold text-gray-700 cursor-pointer"},os={key:1,class:"flex justify-center p-5 text-gray-400"},as={class:"text-base text-gray-500 cursor-pointer"},ns={class:"m-0 ml-3 text-sm leading-none cursor-pointer font-base text-primary-400"},rs={props:{type:{type:String,default:null},store:{type:Object,default:null},storeProp:{type:String,default:""}},emits:["select:taxType"],setup(s,{emit:t}){const e=s,r=H(),B=oe(),w=re(),{t:_}=J(),y=F(null),D=S(()=>y.value?B.taxTypes.filter(function(P){return P.name.toLowerCase().indexOf(y.value.toLowerCase())!==-1}):B.taxTypes),f=S(()=>e.store[e.storeProp].taxes);function V(P,u){t("select:taxType",{...P}),u()}function j(){r.openModal({title:_("settings.tax_types.add_tax"),componentName:"TaxTypeModal",size:"sm",refreshData:P=>t("select:taxType",P)})}return(P,u)=>{const l=g("BaseIcon"),p=g("BaseInput");return i(),$("div",Rt,[a(o(je),{class:"relative"},{default:m(({isOpen:d})=>[a(o(Me),{class:Y([d?"":"text-opacity-90","flex items-center text-sm font-medium text-primary-400 focus:outline-none focus:border-none"])},{default:m(()=>[a(l,{name:"PlusIcon",class:"w-4 h-4 font-medium text-primary-400"}),A(" "+v(P.$t("settings.tax_types.add_tax")),1)]),_:2},1032,["class"]),n("div",Xt,[a(De,{"enter-active-class":"transition duration-200 ease-out","enter-from-class":"translate-y-1 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition duration-150 ease-in","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-1 opacity-0"},{default:m(()=>[a(o(Ve),{style:{"min-width":"350px","margin-left":"62px",top:"-28px"},class:"absolute z-10 px-4 py-2 -translate-x-full sm:px-0"},{default:m(({close:M})=>[n("div",Ht,[n("div",Jt,[n("div",Kt,[a(p,{modelValue:y.value,"onUpdate:modelValue":u[0]||(u[0]=h=>y.value=h),placeholder:P.$t("general.search"),type:"text",class:"text-black"},null,8,["modelValue","placeholder"])]),o(D).length>0?(i(),$("div",Qt,[(i(!0),$(Q,null,se(o(D),(h,C)=>(i(),$("div",{key:C,class:Y([{"bg-gray-100 cursor-not-allowed opacity-50 pointer-events-none":o(f).find(T=>T.tax_type_id===h.id)},"px-6 py-4 border-b border-gray-200 border-solid cursor-pointer hover:bg-gray-100 hover:cursor-pointer last:border-b-0"]),tabindex:"2",onClick:T=>V(h,M)},[n("div",es,[n("label",ts,v(h.name),1),n("label",ss,v(h.percent)+" % ",1)])],10,Zt))),128))])):(i(),$("div",os,[n("label",as,v(P.$t("general.no_tax_found")),1)]))]),o(w).hasAbilities(o(de).CREATE_TAX_TYPE)?(i(),$("button",{key:0,type:"button",class:"flex items-center justify-center w-full h-10 px-2 py-3 bg-gray-200 border-none outline-none",onClick:j},[a(l,{name:"CheckCircleIcon",class:"text-primary-400"}),n("label",ns,v(P.$t("estimates.add_new_tax")),1)])):L("",!0)])]),_:1})]),_:1})])]),_:1})])}}},ls={class:"px-5 py-4 mt-6 bg-white border border-gray-200 border-solid rounded md:min-w-[390px] min-w-[300px] lg:mt-7"},is={class:"flex items-center justify-between w-full"},ds={key:1,class:"text-sm font-semibold leading-5 text-gray-400 uppercase"},cs={key:3,class:"flex items-center justify-center m-0 text-lg text-black uppercase"},us={key:1,class:"m-0 text-sm font-semibold leading-5 text-gray-500 uppercase"},ms={key:3,class:"flex items-center justify-center m-0 text-lg text-black uppercase"},ps={key:0,class:"flex items-center justify-between w-full mt-2"},ys={key:1,class:"text-sm font-semibold leading-5 text-gray-400 uppercase"},fs={key:3,class:"flex",style:{width:"140px"},role:"group"},xs={class:"flex items-center"},_s={key:1},gs={class:"flex items-center justify-between w-full pt-2 mt-5 border-t border-gray-200 border-solid"},hs={key:1,class:"m-0 text-sm font-semibold leading-5 text-gray-400 uppercase"},vs={key:3,class:"flex items-center justify-center text-lg uppercase text-primary-400"},Js={props:{store:{type:Object,default:null},storeProp:{type:String,default:""},taxPopupType:{type:String,default:""},currency:{type:[Object,String],default:""},isLoading:{type:Boolean,default:!1}},setup(s){const t=s,e=F(null);le("$utils");const r=ae(),B=S({get:()=>t.store[t.storeProp].discount,set:u=>{t.store[t.storeProp].discount_type==="percentage"?t.store[t.storeProp].discount_val=Math.round(t.store.getSubTotal*u/100):t.store[t.storeProp].discount_val=Math.round(u*100),t.store[t.storeProp].discount=u}}),w=S({get:()=>t.store[t.storeProp].taxes,set:u=>{t.store.$patch(l=>{l[t.storeProp].taxes=u})}}),_=S(()=>{let u=[];return t.store[t.storeProp].items.forEach(l=>{l.taxes&&l.taxes.forEach(p=>{let d=u.find(M=>M.tax_type_id===p.tax_type_id);d?d.amount+=p.amount:p.tax_type_id&&u.push({tax_type_id:p.tax_type_id,amount:p.amount,percent:p.percent,name:p.name})})}),u}),y=S(()=>t.currency?t.currency:r.selectedCompanyCurrency);function D(){t.store[t.storeProp].discount_type!=="fixed"&&(t.store[t.storeProp].discount_val=Math.round(t.store[t.storeProp].discount*100),t.store[t.storeProp].discount_type="fixed")}function f(){t.store[t.storeProp].discount_type!=="percentage"&&(t.store[t.storeProp].discount_val=t.store.getSubTotal*t.store[t.storeProp].discount/100,t.store[t.storeProp].discount_type="percentage")}function V(u){let l=0;u.compound_tax&&t.store.getSubtotalWithDiscount?l=Math.round((t.store.getSubtotalWithDiscount+t.store.getTotalSimpleTax)*u.percent/100):t.store.getSubtotalWithDiscount&&u.percent&&(l=Math.round(t.store.getSubtotalWithDiscount*u.percent/100));let p={...de,id:he.raw(),name:u.name,percent:u.percent,compound_tax:u.compound_tax,tax_type_id:u.id,amount:l};t.store.$patch(d=>{d[t.storeProp].taxes.push({...p})})}function j(u){const l=t.store[t.storeProp].taxes.find(p=>p.id===u.id);l&&Object.assign(l,{...u})}function P(u){const l=t.store[t.storeProp].taxes.findIndex(p=>p.id===u);t.store.$patch(p=>{p[t.storeProp].taxes.splice(l,1)})}return(u,l)=>{const p=g("BaseContentPlaceholdersText"),d=g("BaseContentPlaceholders"),M=g("BaseFormatMoney"),h=g("BaseInput"),C=g("BaseIcon"),T=g("BaseButton"),x=g("BaseDropdownItem"),b=g("BaseDropdown");return i(),$("div",ls,[n("div",is,[s.isLoading?(i(),q(d,{key:0},{default:m(()=>[a(p,{lines:1,class:"w-16 h-5"})]),_:1})):(i(),$("label",ds,v(u.$t("estimates.sub_total")),1)),s.isLoading?(i(),q(d,{key:2},{default:m(()=>[a(p,{lines:1,class:"w-16 h-5"})]),_:1})):(i(),$("label",cs,[a(M,{amount:s.store.getSubTotal,currency:o(y)},null,8,["amount","currency"])]))]),(i(!0),$(Q,null,se(o(_),k=>(i(),$("div",{key:k.tax_type_id,class:"flex items-center justify-between w-full"},[s.isLoading?(i(),q(d,{key:0},{default:m(()=>[a(p,{lines:1,class:"w-16 h-5"})]),_:1})):s.store[s.storeProp].tax_per_item==="YES"?(i(),$("label",us,v(k.name)+" - "+v(k.percent)+"% ",1)):L("",!0),s.isLoading?(i(),q(d,{key:2},{default:m(()=>[a(p,{lines:1,class:"w-16 h-5"})]),_:1})):s.store[s.storeProp].tax_per_item==="YES"?(i(),$("label",ms,[a(M,{amount:k.amount,currency:o(y)},null,8,["amount","currency"])])):L("",!0)]))),128)),s.store[s.storeProp].discount_per_item==="NO"||s.store[s.storeProp].discount_per_item===null?(i(),$("div",ps,[s.isLoading?(i(),q(d,{key:0},{default:m(()=>[a(p,{lines:1,class:"w-16 h-5"})]),_:1})):(i(),$("label",ys,v(u.$t("estimates.discount")),1)),s.isLoading?(i(),q(d,{key:2},{default:m(()=>[a(p,{lines:1,class:"w-24 h-8 border rounded-md"})]),_:1})):(i(),$("div",fs,[a(h,{modelValue:o(B),"onUpdate:modelValue":l[0]||(l[0]=k=>te(B)?B.value=k:null),class:"border-r-0 focus:border-r-2 rounded-tr-sm rounded-br-sm h-[38px]"},null,8,["modelValue"]),a(b,{position:"bottom-end"},{activator:m(()=>[a(T,{class:"p-2 rounded-none rounded-tr-md rounded-br-md",type:"button",variant:"white"},{default:m(()=>[n("span",xs,[A(v(s.store[s.storeProp].discount_type=="fixed"?o(y).symbol:"%")+" ",1),a(C,{name:"ChevronDownIcon",class:"w-4 h-4 ml-1 text-gray-500"})])]),_:1})]),default:m(()=>[a(x,{onClick:D},{default:m(()=>[A(v(u.$t("general.fixed")),1)]),_:1}),a(x,{onClick:f},{default:m(()=>[A(v(u.$t("general.percentage")),1)]),_:1})]),_:1})]))])):L("",!0),s.store[s.storeProp].tax_per_item==="NO"||s.store[s.storeProp].tax_per_item===null?(i(),$("div",_s,[(i(!0),$(Q,null,se(o(w),(k,O)=>(i(),q(Yt,{key:k.id,index:O,tax:k,taxes:o(w),currency:s.currency,store:s.store,onRemove:P,onUpdate:j},null,8,["index","tax","taxes","currency","store"]))),128))])):L("",!0),s.store[s.storeProp].tax_per_item==="NO"||s.store[s.storeProp].tax_per_item===null?(i(),$("div",{key:2,ref:(k,O)=>{O.taxModal=k,e.value=k},class:"float-right pt-2 pb-4"},[a(rs,{"store-prop":s.storeProp,store:s.store,type:s.taxPopupType,"onSelect:taxType":V},null,8,["store-prop","store","type"])],512)):L("",!0),n("div",gs,[s.isLoading?(i(),q(d,{key:0},{default:m(()=>[a(p,{lines:1,class:"w-16 h-5"})]),_:1})):(i(),$("label",hs,v(u.$t("estimates.total"))+" "+v(u.$t("estimates.amount"))+":",1)),s.isLoading?(i(),q(d,{key:2},{default:m(()=>[a(p,{lines:1,class:"w-16 h-5"})]),_:1})):(i(),$("label",vs,[a(M,{amount:s.store.getTotal,currency:o(y)},null,8,["amount","currency"])]))])])}}},bs={class:"flex text-gray-800 font-medium text-sm mb-2"},$s=n("span",{class:"text-sm text-red-500"}," *",-1),Ks={props:{store:{type:Object,default:null},storeProp:{type:String,default:""},isMarkAsDefault:{type:Boolean,default:!1}},setup(s){const t=s,e=H(),{t:r}=J();function B(){let w="";t.storeProp=="newEstimate"?w=r("estimates.mark_as_default_estimate_template_description"):t.storeProp=="newInvoice"&&(w=r("invoices.mark_as_default_invoice_template_description")),e.openModal({title:r("general.choose_template"),componentName:"SelectTemplate",data:{templates:t.store.templates,store:t.store,storeProp:t.storeProp,isMarkAsDefault:t.isMarkAsDefault,markAsDefaultDescription:w}})}return(w,_)=>{const y=g("BaseIcon"),D=g("BaseButton");return i(),$("div",null,[n("label",bs,[A(v(w.$t("general.select_template"))+" ",1),$s]),a(D,{type:"button",class:"flex justify-center w-full text-sm lg:w-auto hover:bg-gray-200",variant:"gray",onClick:B},{right:m(f=>[a(y,{name:"PencilIcon",class:Y(f.class)},null,8,["class"])]),default:m(()=>[A(" "+v(s.store[s.storeProp].template_name),1)]),_:1})])}}},ws={class:"mb-6"},Bs={class:"z-20 text-sm font-semibold leading-5 text-primary-400 float-right"},Is={class:"text-gray-800 font-medium mb-4 text-sm"},Qs={props:{store:{type:Object,default:null},storeProp:{type:String,default:""},fields:{type:Array,default:[]},type:{type:String,default:null}},setup(s){const t=s;function e(r){t.store[t.storeProp].notes=""+r.notes}return(r,B)=>{const w=g("BaseCustomInput");return i(),$("div",ws,[n("div",Bs,[a(Ue,{type:s.type,onSelect:e},null,8,["type"])]),n("label",Is,v(r.$t("invoices.notes")),1),a(w,{modelValue:s.store[s.storeProp].notes,"onUpdate:modelValue":B[0]||(B[0]=_=>s.store[s.storeProp].notes=_),"content-loading":s.store.isFetchingInitialSettings,fields:s.fields,class:"mt-1"},null,8,["modelValue","content-loading","fields"])])}}},Ss={class:"flex justify-between w-full"},Ps={class:"px-8 py-8 sm:p-6"},Ts={key:0,class:"grid grid-cols-3 gap-2 p-1 overflow-x-auto"},ks=["onClick"],Cs=["src","alt"],Ms=["alt","src"],Ds={key:1,class:"z-0 flex ml-3 pt-5"},Vs={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},Zs={setup(s){const t=H(),e=re(),r=F(""),B=S(()=>t.active&&t.componentName==="SelectTemplate"),w=S(()=>t.title);function _(){t.data.store[t.data.storeProp].template_name?r.value=t.data.store[t.data.storeProp].template_name:r.value=t.data.templates[0]}async function y(){await t.data.store.setTemplate(r.value),!t.data.store.isEdit&&t.data.isMarkAsDefault&&(t.data.storeProp=="newEstimate"?await e.updateUserSettings({settings:{default_estimate_template:r.value}}):t.data.storeProp=="newInvoice"&&await e.updateUserSettings({settings:{default_invoice_template:r.value}})),f()}function D(){return"imgUrl"}function f(){t.closeModal(),setTimeout(()=>{t.$reset()},300)}return(V,j)=>{const P=g("BaseIcon"),u=g("BaseCheckbox"),l=g("BaseButton"),p=g("BaseModal");return i(),q(p,{show:o(B),onClose:f,onOpen:_},{header:m(()=>[n("div",Ss,[A(v(o(w))+" ",1),a(P,{name:"XIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:f})])]),default:m(()=>[n("div",Ps,[o(t).data?(i(),$("div",Ts,[(i(!0),$(Q,null,se(o(t).data.templates,(d,M)=>(i(),$("div",{key:M,class:Y([{"border border-solid border-gray-500":r.value===d.name},"relative flex flex-col m-2 border border-gray-200 border-solid cursor-pointer hover:border-gray-300"]),onClick:h=>r.value=d.name},[n("img",{src:d.path,alt:d.name,class:"w-full min-h-[100px]"},null,8,Cs),r.value===d.name?(i(),$("img",{key:0,alt:d.name,class:"absolute z-10 w-5 h-5 text-primary-500",style:{top:"-6px",right:"-5px"},src:D()},null,8,Ms)):L("",!0),n("span",{class:Y(["w-full p-1 bg-gray-200 text-sm text-center absolute bottom-0 left-0",{"text-primary-500 bg-gray-100":r.value===d.name,"text-gray-600":r.value!=d.name}])},v(d.name),3)],10,ks))),128))])):L("",!0),o(t).data.store.isEdit?L("",!0):(i(),$("div",Ds,[a(u,{modelValue:o(t).data.isMarkAsDefault,"onUpdate:modelValue":j[0]||(j[0]=d=>o(t).data.isMarkAsDefault=d),"set-initial-value":!1,variant:"primary",label:V.$t("general.mark_as_default"),description:o(t).data.markAsDefaultDescription},null,8,["modelValue","label","description"])]))]),n("div",Vs,[a(l,{class:"mr-3",variant:"primary-outline",onClick:f},{default:m(()=>[A(v(V.$t("general.cancel")),1)]),_:1}),a(l,{variant:"primary",onClick:j[1]||(j[1]=d=>y())},{left:m(d=>[a(P,{name:"SaveIcon",class:Y(d.class)},null,8,["class"])]),default:m(()=>[A(" "+v(V.$t("general.choose")),1)]),_:1})])]),_:1},8,["show"])}}},js={class:"flex justify-between w-full"},qs={class:"item-modal"},Es=["onSubmit"],As={class:"px-8 py-8 sm:p-6"},Ls={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},eo={emits:["newItem"],setup(s,{emit:t}){const e=H(),r=ge(),B=ae(),w=oe();qe(),Ee();const{t:_}=J(),y=F(!1),D=F(B.selectedCompanySettings.tax_per_item),f=S(()=>e.active&&e.componentName==="ItemModal"),V=S({get:()=>r.currentItem.price/100,set:h=>{r.currentItem.price=Math.round(h*100)}}),j=S({get:()=>r.currentItem.taxes.map(h=>{if(h)return{...h,tax_type_id:h.id,tax_name:h.name+" ("+h.percent+"%)"}}),set:h=>{r.$patch(C=>{C.currentItem.taxes=h})}}),P=S(()=>D.value==="YES"),u={name:{required:z.withMessage(_("validation.required"),X),minLength:z.withMessage(_("validation.name_min_length",{count:3}),Ae(3))},description:{maxLength:z.withMessage(_("validation.description_maxlength",{count:255}),ne(255))}},l=ie(u,S(()=>r.currentItem)),p=S(()=>w.taxTypes.map(h=>({...h,tax_name:h.name+" ("+h.percent+"%)"})));ve(()=>{l.value.$reset(),r.fetchItemUnits({limit:"all"})});async function d(){if(l.value.$touch(),l.value.$invalid)return!0;let h={...r.currentItem,taxes:r.currentItem.taxes.map(T=>({tax_type_id:T.id,amount:V.value*T.percent/100,percent:T.percent,name:T.name,collective_tax:0}))};y.value=!0,await(r.isEdit?r.updateItem:r.addItem)(h).then(T=>{y.value=!1,T.data.data&&e.data&&e.refreshData(T.data.data),M()})}function M(){e.closeModal(),setTimeout(()=>{r.resetCurrentItem(),e.$reset(),l.value.$reset()},300)}return(h,C)=>{const T=g("BaseIcon"),x=g("BaseInput"),b=g("BaseInputGroup"),k=g("BaseMoney"),O=g("BaseMultiselect"),Z=g("BaseTextarea"),ee=g("BaseInputGrid"),W=g("BaseButton"),U=g("BaseModal");return i(),q(U,{show:o(f),onClose:M},{header:m(()=>[n("div",js,[A(v(o(e).title)+" ",1),a(T,{name:"XIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:M})])]),default:m(()=>[n("div",qs,[n("form",{action:"",onSubmit:be(d,["prevent"])},[n("div",As,[a(ee,{layout:"one-column"},{default:m(()=>[a(b,{label:h.$t("items.name"),required:"",error:o(l).name.$error&&o(l).name.$errors[0].$message},{default:m(()=>[a(x,{modelValue:o(r).currentItem.name,"onUpdate:modelValue":C[0]||(C[0]=c=>o(r).currentItem.name=c),type:"text",invalid:o(l).name.$error,onInput:C[1]||(C[1]=c=>o(l).name.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"]),a(b,{label:h.$t("items.price")},{default:m(()=>[a(k,{key:o(B).selectedCompanyCurrency,modelValue:o(V),"onUpdate:modelValue":C[2]||(C[2]=c=>te(V)?V.value=c:null),currency:o(B).selectedCompanyCurrency,class:"relative w-full focus:border focus:border-solid focus:border-gray"},null,8,["modelValue","currency"])]),_:1},8,["label"]),a(b,{label:h.$t("items.unit")},{default:m(()=>[a(O,{modelValue:o(r).currentItem.unit_id,"onUpdate:modelValue":C[3]||(C[3]=c=>o(r).currentItem.unit_id=c),label:"name",options:o(r).itemUnits,"value-prop":"id","can-deselect":!1,"can-clear":!1,placeholder:h.$t("items.select_a_unit"),searchable:"","track-by":"name"},null,8,["modelValue","options","placeholder"])]),_:1},8,["label"]),o(P)?(i(),q(b,{key:0,label:h.$t("items.taxes")},{default:m(()=>[a(O,{modelValue:o(j),"onUpdate:modelValue":C[4]||(C[4]=c=>te(j)?j.value=c:null),options:o(p),mode:"tags",label:"tax_name","value-prop":"id",class:"w-full","can-deselect":!1,"can-clear":!1,searchable:"","track-by":"tax_name",object:""},null,8,["modelValue","options"])]),_:1},8,["label"])):L("",!0),a(b,{label:h.$t("items.description"),error:o(l).description.$error&&o(l).description.$errors[0].$message},{default:m(()=>[a(Z,{modelValue:o(r).currentItem.description,"onUpdate:modelValue":C[5]||(C[5]=c=>o(r).currentItem.description=c),rows:"4",cols:"50",invalid:o(l).description.$error,onInput:C[6]||(C[6]=c=>o(l).description.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"])]),_:1})]),n("div",Ls,[a(W,{class:"mr-3",variant:"primary-outline",type:"button",onClick:M},{default:m(()=>[A(v(h.$t("general.cancel")),1)]),_:1}),a(W,{loading:y.value,disabled:y.value,variant:"primary",type:"submit"},{left:m(c=>[a(T,{name:"SaveIcon",class:Y(c.class)},null,8,["class"])]),default:m(()=>[A(" "+v(o(r).isEdit?h.$t("general.update"):h.$t("general.save")),1)]),_:1},8,["loading","disabled"])])],40,Es)])]),_:1},8,["show"])}}},Os={class:"flex justify-between w-full"},zs={class:"flex flex-col"},Us={class:"text-sm text-gray-500 mt-1"},Ns=["onSubmit"],Fs={class:"p-4 sm:p-6"},Ws={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},Gs={emits:["addTax"],setup(s,{emit:t}){const e=H();Le();const r=_e({state:"",city:"",address_street_1:"",zip:""}),B=F(!1),w=oe(),{t:_}=J(),y=S(()=>e.active&&e.componentName==="TaxationAddressModal"),D=S(()=>({state:{required:z.withMessage(_("validation.required"),X)},city:{required:z.withMessage(_("validation.required"),X)},address_street_1:{required:z.withMessage(_("validation.required"),X)},zip:{required:z.withMessage(_("validation.required"),X)}})),f=ie(D,S(()=>r));async function V(){if(f.value.$touch(),f.value.$invalid)return!0;let u={address:r};e.id&&(u.customer_id=e.id),r.address_street_1=r.address_street_1.replace(/(\r\n|\n|\r)/gm,""),B.value=!0,await w.fetchSalesTax(u).then(l=>{B.value=!1,t("addTax",l.data.data),P()}).catch(l=>{B.value=!1})}function j(){var u,l,p,d;r.state=(u=e==null?void 0:e.data)==null?void 0:u.state,r.city=(l=e==null?void 0:e.data)==null?void 0:l.city,r.address_street_1=(p=e==null?void 0:e.data)==null?void 0:p.address_street_1,r.zip=(d=e==null?void 0:e.data)==null?void 0:d.zip}function P(){e.closeModal()}return(u,l)=>{const p=g("BaseIcon"),d=g("BaseInput"),M=g("BaseInputGroup"),h=g("BaseTextarea"),C=g("BaseInputGrid"),T=g("BaseButton"),x=g("BaseModal");return i(),q(x,{show:o(y),onClose:P,onOpen:j},{header:m(()=>[n("div",Os,[n("div",zs,[A(v(o(e).title)+" ",1),n("p",Us,v(o(e).content),1)]),a(p,{name:"XIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:P})])]),default:m(()=>[n("form",{onSubmit:be(V,["prevent"])},[n("div",Fs,[a(C,{layout:"one-column"},{default:m(()=>[a(M,{required:"",error:o(f).state.$error&&o(f).state.$errors[0].$message,label:u.$t("customers.state")},{default:m(()=>[a(d,{modelValue:o(r).state,"onUpdate:modelValue":l[0]||(l[0]=b=>o(r).state=b),type:"text",name:"shippingState",class:"mt-1 md:mt-0",invalid:o(f).state.$error,onInput:l[1]||(l[1]=b=>o(f).state.$touch()),placeholder:u.$t("settings.taxations.state_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"]),a(M,{required:"",error:o(f).city.$error&&o(f).city.$errors[0].$message,label:u.$t("customers.city")},{default:m(()=>[a(d,{modelValue:o(r).city,"onUpdate:modelValue":l[2]||(l[2]=b=>o(r).city=b),type:"text",name:"shippingCity",class:"mt-1 md:mt-0",invalid:o(f).city.$error,onInput:l[3]||(l[3]=b=>o(f).city.$touch()),placeholder:u.$t("settings.taxations.city_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"]),a(M,{required:"",error:o(f).address_street_1.$error&&o(f).address_street_1.$errors[0].$message,label:u.$t("customers.address")},{default:m(()=>[a(h,{modelValue:o(r).address_street_1,"onUpdate:modelValue":l[4]||(l[4]=b=>o(r).address_street_1=b),rows:"2",cols:"50",class:"mt-1 md:mt-0",invalid:o(f).address_street_1.$error,onInput:l[5]||(l[5]=b=>o(f).address_street_1.$touch()),placeholder:u.$t("settings.taxations.address_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"]),a(M,{required:"",error:o(f).zip.$error&&o(f).zip.$errors[0].$message,label:u.$t("customers.zip_code")},{default:m(()=>[a(d,{modelValue:o(r).zip,"onUpdate:modelValue":l[6]||(l[6]=b=>o(r).zip=b),invalid:o(f).zip.$error,onInput:l[7]||(l[7]=b=>o(f).zip.$touch()),type:"text",class:"mt-1 md:mt-0",placeholder:u.$t("settings.taxations.zip_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"])]),_:1})]),n("div",Ws,[a(T,{class:"mr-3 text-sm",type:"button",variant:"primary-outline",onClick:P},{default:m(()=>[A(v(u.$t("general.cancel")),1)]),_:1}),a(T,{loading:B.value,variant:"primary",type:"submit"},{left:m(b=>[B.value?L("",!0):(i(),q(p,{key:0,name:"SaveIcon",class:Y(b.class)},null,8,["class"]))]),default:m(()=>[A(" "+v(u.$t("general.save")),1)]),_:1},8,["loading"])])],40,Ns)]),_:1},8,["show"])}}},to={props:{isEdit:{type:Boolean,default:null},type:{type:String,default:null},customer:{type:[Object],default:null},store:{type:Object,default:null},storeProp:{type:String,default:null}},setup(s){const t=s,e="Sales Tax",r="MODULE",B=H(),w=ae(),_=oe(),{t:y}=J(),D=F(!1),f=S(()=>t.isEdit?t.store[t.storeProp].sales_tax_address_type==="billing":w.selectedCompanySettings.sales_tax_address_type==="billing"),V=S(()=>w.selectedCompanySettings.sales_tax_us_enabled==="YES"),j=S(()=>t.isEdit?t.store[t.storeProp].sales_tax_type==="customer_level":w.selectedCompanySettings.sales_tax_type==="customer_level"),P=S(()=>t.isEdit?t.store[t.storeProp].sales_tax_type==="company_level":w.selectedCompanySettings.sales_tax_type==="company_level"),u=S(()=>{if(j.value&&l.value){let x=f.value?t.customer.billing:t.customer.shipping;return{address:R.exports.pick(x,["address_street_1","city","state","zip"]),customer_id:t.customer.id}}else if(P.value&&l.value)return{address:R.exports.pick(address,["address_street_1","city","state","zip"])}}),l=S(()=>{var x,b;if(j.value){let k=f.value?(x=t.customer)==null?void 0:x.billing:(b=t.customer)==null?void 0:b.shipping;return p(k)}else if(P.value)return p(w.selectedCompany.address);return!1});K(()=>t.customer,(x,b)=>{if(x&&b&&j.value){d(x,b);return}!l.value&&j.value&&x?setTimeout(()=>{M()},500):j.value&&x?h():j.value&&!x&&T()}),ve(()=>{P.value&&(l.value?h():M())});function p(x){return x?x.address_street_1&&x.city&&x.state&&x.zip:!1}function d(x,b){const k=f.value?x.billing:x.shipping,O=f.value?b.billing:b.shipping,Z=R.exports.pick(k,["address_street_1","city","state","zip"]),ee=R.exports.pick(O,["address_street_1","city","state","zip"]);R.exports.isEqual(Z,ee)||h()}function M(){var k,O;if(!V.value)return;let x=null,b="";j.value?f.value?(x=(k=t.customer)==null?void 0:k.billing,b=y("settings.taxations.add_billing_address")):(x=(O=t.customer)==null?void 0:O.shipping,b=y("settings.taxations.add_shipping_address")):(x=w.selectedCompany.address,b=y("settings.taxations.add_company_address")),B.openModal({title:b,content:y("settings.taxations.modal_description"),componentName:"TaxationAddressModal",data:x,id:j.value?t.customer.id:""})}async function h(){V.value&&(D.value=!0,await _.fetchSalesTax(u.value).then(x=>{C(x.data.data),D.value=!1}).catch(x=>{x.response.data.error&&setTimeout(()=>{M()},500),D.value=!1}))}function C(x){x.tax_type_id=x.id;const b=t.store[t.storeProp].taxes.findIndex(k=>k.name===e&&k.type===r);b>-1?Object.assign(t.store[t.storeProp].taxes[b],x):t.store[t.storeProp].taxes.push(x)}function T(){const x=t.store[t.storeProp].taxes.findIndex(k=>k.name===e&&k.type===r);x>-1&&t.store[t.storeProp].taxes.splice(x,1);let b=_.taxTypes.findIndex(k=>k.name===e&&k.type===r);b>-1&&_.taxTypes.splice(b,1)}return(x,b)=>(i(),q(Gs,{onAddTax:C}))}};export{Zs as _,eo as a,to as b,Hs as c,Qs as d,Ks as e,Js as f};
