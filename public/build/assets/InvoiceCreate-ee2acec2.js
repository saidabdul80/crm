import{aB as L,r as l,o as u,c as P,a as t,m as n,w as s,C as z,ar as J,aG as O,e as Y,J as K,f as Q,g as C,l as I,h as p,i as y,au as W,as as X,V as Z,k as ee,A as ne,n as b,I as k,b as $,t as q,H as te,q as oe,s as ie,L as ae}from"./main-9a914193.js";import{_ as se,a as le,b as ce,c as re,d as ue,e as de,f as me}from"./SalesTax-de99494f.js";import{_ as ve}from"./ExchangeRateConverter-ea9ed32b.js";import{_ as ge}from"./CreateCustomFields-c13ceebe.js";import{_ as pe}from"./TaxTypeModal-da1630a1.js";import"./DragIcon-0725a09c.js";import"./SelectNotePopup-65fee220.js";import"./NoteModal-827b704f.js";import"./payment-0bb414a0.js";import"./exchange-rate-938880b7.js";import"./dynamic-import-helper-be004503.js";const fe={class:"grid grid-cols-12 gap-8 mt-6 mb-8"},_e={props:{v:{type:Object,default:null},isLoading:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1}},setup(o){const e=L();return(d,c)=>{const B=l("BaseCustomerSelectPopup"),r=l("BaseDatePicker"),m=l("BaseInputGroup"),h=l("BaseInput"),f=l("BaseInputGrid");return u(),P("div",fe,[t(B,{modelValue:n(e).newInvoice.customer,"onUpdate:modelValue":c[0]||(c[0]=i=>n(e).newInvoice.customer=i),valid:o.v.customer_id,"content-loading":o.isLoading,type:"invoice",class:"col-span-12 lg:col-span-5 pr-0"},null,8,["modelValue","valid","content-loading"]),t(f,{class:"col-span-12 lg:col-span-7"},{default:s(()=>[t(m,{label:d.$t("invoices.invoice_date"),"content-loading":o.isLoading,required:"",error:o.v.invoice_date.$error&&o.v.invoice_date.$errors[0].$message},{default:s(()=>[t(r,{modelValue:n(e).newInvoice.invoice_date,"onUpdate:modelValue":c[1]||(c[1]=i=>n(e).newInvoice.invoice_date=i),"content-loading":o.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),t(m,{label:d.$t("invoices.due_date"),"content-loading":o.isLoading},{default:s(()=>[t(r,{modelValue:n(e).newInvoice.due_date,"onUpdate:modelValue":c[2]||(c[2]=i=>n(e).newInvoice.due_date=i),"content-loading":o.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading"]),t(m,{label:d.$t("invoices.invoice_number"),"content-loading":o.isLoading,error:o.v.invoice_number.$error&&o.v.invoice_number.$errors[0].$message,required:""},{default:s(()=>[t(h,{disabled:"",modelValue:n(e).newInvoice.invoice_number,"onUpdate:modelValue":c[3]||(c[3]=i=>n(e).newInvoice.invoice_number=i),"content-loading":o.isLoading,onInput:c[4]||(c[4]=i=>o.v.invoice_number.$touch())},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),t(ve,{store:n(e),"store-prop":"newInvoice",v:o.v,key:o.isLoading,"is-loading":o.isLoading,"is-edit":o.isEdit,"customer-currency":n(e).newInvoice.currency_id},null,8,["store","v","is-loading","is-edit","customer-currency"])]),_:1})])}}},Ie=["onSubmit"],be={class:"flex"},we={class:"block mt-10 invoice-foot lg:flex lg:justify-between lg:items-start"},ye={class:"relative w-full lg:w-1/2 lg:mr-4"},Te={setup(o){const e=L(),d=z(),c=J(),B=O(),{t:r}=Y();let m=K(),h=Q();const f="newInvoice";let i=C(!1);const M=C(!1),T=C(["customer","company","customerCustom","invoice","invoiceCustom"]);let _=I(()=>e.isFetchingInvoice||e.isFetchingInitialSettings),x=I(()=>v.value?r("invoices.edit_invoice"):r("invoices.new_invoice"));const E=I(()=>d.selectedCompanySettings.sales_tax_us_enabled==="YES"&&B.salesTaxUSEnabled);let v=I(()=>m.name==="invoices.edit");const F={invoice_date:{required:p.withMessage(r("validation.required"),y)},reference_number:{maxLength:p.withMessage(r("validation.price_maxlength"),W(255))},customer_id:{required:p.withMessage(r("validation.required"),y)},invoice_number:{required:p.withMessage(r("validation.required"),y)},exchange_rate:{required:X(function(){return p.withMessage(r("validation.required"),y),e.showExchangeRate}),decimal:p.withMessage(r("validation.valid_exchange_rate"),Z)}},w=ee(F,I(()=>e.newInvoice),{$scope:f});c.resetCustomFields(),w.value.$reset,e.resetCurrentInvoice(),e.fetchInvoiceInitialSettings(v.value),ne(()=>e.newInvoice.customer,a=>{a&&a.currency?e.newInvoice.selectedCurrency=a.currency:e.newInvoice.selectedCurrency=d.selectedCompanyCurrency});async function G(){if(w.value.$touch(),w.value.$invalid)return!1;i.value=!0;let a={...e.newInvoice,sub_total:e.getSubTotal,total:e.getTotal,tax:e.getTotalTax};try{const g=await(v.value?e.updateInvoice:e.addInvoice)(a);h.push(`/admin/invoices/${g.data.data.id}/view`)}catch(S){console.error(S)}i.value=!1}return(a,S)=>{const g=l("BaseBreadcrumbItem"),N=l("BaseBreadcrumb"),V=l("BaseButton"),U=l("router-link"),D=l("BaseIcon"),H=l("BasePageHeader"),R=l("BaseScrollPane"),j=l("BasePage");return u(),P(ae,null,[t(se),t(le),t(pe),n(E)&&(!n(_)||n(m).query.customer)?(u(),b(ce,{key:0,store:n(e),"is-edit":n(v),"store-prop":"newInvoice",customer:n(e).newInvoice.customer},null,8,["store","is-edit","customer"])):k("",!0),t(j,{class:"relative invoice-create-page"},{default:s(()=>[$("form",{onSubmit:ie(G,["prevent"])},[t(H,{title:n(x)},{actions:s(()=>[a.$route.name==="invoices.edit"?(u(),b(U,{key:0,to:`/invoices/pdf/${n(e).newInvoice.unique_hash}`,target:"_blank"},{default:s(()=>[t(V,{class:"mr-3",variant:"primary-outline",type:"button"},{default:s(()=>[$("span",be,q(a.$t("general.view_pdf")),1)]),_:1})]),_:1},8,["to"])):k("",!0),t(V,{loading:n(i),disabled:n(i),variant:"primary",type:"submit"},{left:s(A=>[n(i)?k("",!0):(u(),b(D,{key:0,name:"SaveIcon",class:te(A.class)},null,8,["class"]))]),default:s(()=>[oe(" "+q(a.$t("invoices.save_invoice")),1)]),_:1},8,["loading","disabled"])]),default:s(()=>[t(N,null,{default:s(()=>[t(g,{title:a.$t("general.home"),to:"/admin/dashboard"},null,8,["title"]),t(g,{title:a.$t("invoices.invoice",2),to:"/admin/invoices"},null,8,["title"]),a.$route.name==="invoices.edit"?(u(),b(g,{key:0,title:a.$t("invoices.edit_invoice"),to:"#",active:""},null,8,["title"])):(u(),b(g,{key:1,title:a.$t("invoices.new_invoice"),to:"#",active:""},null,8,["title"]))]),_:1})]),_:1},8,["title"]),t(_e,{v:n(w),"is-loading":n(_),"is-edit":n(v)},null,8,["v","is-loading","is-edit"]),t(R,null,{default:s(()=>[t(re,{currency:n(e).newInvoice.selectedCurrency,"is-loading":n(_),"item-validation-scope":f,store:n(e),"store-prop":"newInvoice"},null,8,["currency","is-loading","store"]),$("div",we,[$("div",ye,[t(ue,{store:n(e),"store-prop":"newInvoice",fields:T.value,type:"Invoice"},null,8,["store","fields"]),t(ge,{type:"Invoice","is-edit":n(v),"is-loading":n(_),store:n(e),"store-prop":"newInvoice","custom-field-scope":f,class:"mb-6"},null,8,["is-edit","is-loading","store"]),t(de,{store:n(e),"store-prop":"newInvoice","component-name":"InvoiceTemplate","is-mark-as-default":M.value},null,8,["store","is-mark-as-default"])]),t(me,{currency:n(e).newInvoice.selectedCurrency,"is-loading":n(_),store:n(e),"store-prop":"newInvoice","tax-popup-type":"invoice"},null,8,["currency","is-loading","store"])])]),_:1})],40,Ie)]),_:1})],64)}}};export{Te as default};
