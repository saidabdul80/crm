import{D as re,aB as ie,K as de,a6 as ue,e as ce,g as y,J as me,F as ve,l as S,A as fe,N as pe,r as d,o as i,c as w,a as s,n as v,w as o,b as u,m as r,O as M,q as E,t as g,I as f,H,L as O,M as _e}from"./main-9a914193.js";import{_ as ye}from"./SendInvoiceModal-fb6f321d.js";import{_ as ge}from"./InvoiceIndexDropdown-a1d1e3d6.js";import{L as be}from"./LoadingIcon-6816e437.js";import"./mail-driver-c2eadad2.js";const he={class:"text-sm mr-3"},Be={class:"fixed top-0 left-0 hidden h-full pt-16 pb-[6.4rem] ml-56 bg-white xl:ml-64 w-88 xl:block"},xe={class:"flex items-center justify-between px-4 pt-8 pb-2 border border-gray-200 border-solid height-full"},Ie={class:"mb-6"},ke={class:"flex mb-6 ml-3",role:"group","aria-label":"First group"},Se={class:"px-2 py-1 pb-2 mb-1 mb-2 text-sm border-b border-gray-200 border-solid"},we={class:"flex-2"},Te={class:"mt-1 mb-2 text-xs not-italic font-medium leading-5 text-gray-600"},Fe={class:"flex-1 whitespace-nowrap right"},Ve={class:"text-sm not-italic font-normal leading-5 text-right text-gray-600 est-date"},Ee={key:0,class:"flex justify-center p-4 items-center"},$e={key:1,class:"flex justify-center px-4 mt-5 text-sm text-gray-600"},De={class:"flex flex-col min-h-0 mt-8 overflow-hidden",style:{height:"75vh"}},Ne=["src"],Ue={setup(Ae){re();const T=ie(),$=de(),q=ue(),{t:b}=ce(),n=y(null),h=me(),F=y(!1),B=y(!1),c=y(null),x=y(1),D=y(1),P=y(null),V=y(!1),a=ve({orderBy:null,orderByField:null,searchText:null}),G=S(()=>n.value.invoice_number),U=S(()=>a.orderBy==="asc"||a.orderBy==null);S(()=>U.value?b("general.ascending"):b("general.descending"));const J=S(()=>`/invoices/pdf/${n.value.unique_hash}`);S(()=>n.value&&n.value.id?invoice.value.id:null),fe(h,(e,l)=>{e.name==="invoices.view"&&j()});async function K(){q.openDialog({title:b("general.are_you_sure"),message:b("invoices.invoice_mark_as_sent"),yesLabel:b("general.ok"),noLabel:b("general.cancel"),variant:"primary",hideNoButton:!1,size:"lg"}).then(async e=>{F.value=!1,e&&(await T.markAsSent({id:n.value.id,status:"SENT"}),n.value.status="SENT",F.value=!0),F.value=!1})}async function W(e){V.value=!0;try{const l=await T.sendInvoice({id:n.value.id,to:n.value.customer.email,body:"-",from:"admin@gmail.com",subject:"New Invoice"})}catch{}V.value=!1}function Y(e){return h.params.id==e}async function I(e,l=!1){if(B.value)return;let m={};a.searchText!==""&&a.searchText!==null&&a.searchText!==void 0&&(m.search=a.searchText),a.orderBy!==null&&a.orderBy!==void 0&&(m.orderBy=a.orderBy),a.orderByField!==null&&a.orderByField!==void 0&&(m.orderByField=a.orderByField),B.value=!0;let _=await T.fetchInvoices({page:e,...m});B.value=!1,c.value=c.value?c.value:[],c.value=[...c.value,..._.data.data],x.value=e||1,D.value=_.data.meta.last_page;let k=c.value.find(N=>N.id==h.params.id);l==!1&&!k&&x.value<D.value&&Object.keys(m).length===0&&I(++x.value),k&&setTimeout(()=>{l==!1&&Q()},500)}function Q(){const e=document.getElementById(`invoice-${h.params.id}`);e&&(e.scrollIntoView({behavior:"smooth"}),e.classList.add("shake"),X())}function X(){P.value.addEventListener("scroll",e=>{e.target.scrollTop>0&&e.target.scrollTop+e.target.clientHeight>e.target.scrollHeight-200&&x.value<D.value&&I(++x.value,!0)})}async function j(){let e=await T.fetchInvoice(h.params.id);e.data&&(n.value={...e.data.data})}async function p(){c.value=[],I()}function Z(){return a.orderBy==="asc"?(a.orderBy="desc",p(),!0):(a.orderBy="asc",p(),!0)}function ee(){let e=c.value.findIndex(l=>l.id===n.value.id);c.value[e]&&(c.value[e].status="SENT",n.value.status="SENT")}return I(),j(),p=pe.exports.debounce(p,500),(e,l)=>{const m=d("BaseButton"),_=d("BaseIcon"),k=d("router-link"),N=d("BasePageHeader"),te=d("BaseInput"),A=d("BaseRadio"),L=d("BaseInputGroup"),C=d("BaseDropdownItem"),ae=d("BaseDropdown"),se=d("BaseText"),oe=d("BaseEstimateStatusBadge"),le=d("BaseFormatMoney"),ne=d("BasePage");return i(),w(O,null,[s(ye,{onUpdate:ee}),n.value?(i(),v(ne,{key:0,class:"xl:pl-96 xl:ml-8"},{default:o(()=>{var R;return[s(N,{title:r(G)},{actions:o(()=>[u("div",he,[n.value.status==="DRAFT"&&r($).hasAbilities(r(M).EDIT_INVOICE)?(i(),v(m,{key:0,disabled:F.value,variant:"primary-outline",onClick:K},{default:o(()=>[E(g(e.$t("invoices.mark_as_sent")),1)]),_:1},8,["disabled"])):f("",!0)]),n.value.status==="DRAFT"&&r($).hasAbilities(r(M).SEND_INVOICE)?(i(),v(m,{key:0,loading:V.value,variant:"primary",class:"text-sm",onClick:W},{left:o(t=>[V.value?(i(),v(_,{key:0,name:"SaveIcon",class:H(t.class)},null,8,["class"])):f("",!0)]),default:o(()=>[E(g(e.$t("invoices.send_invoice"))+" ",1)]),_:1},8,["loading"])):f("",!0),r($).hasAbilities(r(M).CREATE_PAYMENT)?(i(),v(k,{key:1,to:`/admin/payments/${e.$route.params.id}/create`},{default:o(()=>[n.value.status==="SENT"||n.value.status==="VIEWED"?(i(),v(m,{key:0,variant:"primary"},{default:o(()=>[E(g(e.$t("invoices.record_payment")),1)]),_:1})):f("",!0)]),_:1},8,["to"])):f("",!0),s(ge,{class:"ml-3",row:n.value,"load-data":I},null,8,["row"])]),_:1},8,["title"]),u("div",Be,[u("div",xe,[u("div",Ie,[s(te,{modelValue:r(a).searchText,"onUpdate:modelValue":l[0]||(l[0]=t=>r(a).searchText=t),placeholder:e.$t("general.search"),type:"text",variant:"gray",onInput:l[1]||(l[1]=t=>p())},{right:o(()=>[s(_,{name:"SearchIcon",class:"h-5 text-gray-400"})]),_:1},8,["modelValue","placeholder"])]),u("div",ke,[s(ae,{class:"ml-3",position:"bottom-start"},{activator:o(()=>[s(m,{size:"md",variant:"gray"},{default:o(()=>[s(_,{name:"FilterIcon"})]),_:1})]),default:o(()=>[u("div",Se,g(e.$t("general.sort_by")),1),s(C,{class:"flex px-1 py-2 cursor-pointer"},{default:o(()=>[s(L,{class:"-mt-3 font-normal"},{default:o(()=>[s(A,{id:"filter_invoice_date",modelValue:r(a).orderByField,"onUpdate:modelValue":[l[2]||(l[2]=t=>r(a).orderByField=t),p],label:e.$t("reports.invoices.invoice_date"),size:"sm",name:"filter",value:"invoice_date"},null,8,["modelValue","label"])]),_:1})]),_:1}),s(C,{class:"flex px-1 py-2 cursor-pointer"},{default:o(()=>[s(L,{class:"-mt-3 font-normal"},{default:o(()=>[s(A,{id:"filter_due_date",modelValue:r(a).orderByField,"onUpdate:modelValue":[l[3]||(l[3]=t=>r(a).orderByField=t),p],label:e.$t("invoices.due_date"),value:"due_date",size:"sm",name:"filter"},null,8,["modelValue","label"])]),_:1})]),_:1}),s(C,{class:"flex px-1 py-2 cursor-pointer"},{default:o(()=>[s(L,{class:"-mt-3 font-normal"},{default:o(()=>[s(A,{id:"filter_invoice_number",modelValue:r(a).orderByField,"onUpdate:modelValue":[l[4]||(l[4]=t=>r(a).orderByField=t),p],label:e.$t("invoices.invoice_number"),value:"invoice_number",size:"sm",name:"filter"},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1}),s(m,{class:"ml-1",size:"md",variant:"gray",onClick:Z},{default:o(()=>[r(U)?(i(),v(_,{key:0,name:"SortAscendingIcon"})):(i(),v(_,{key:1,name:"SortDescendingIcon"}))]),_:1})])]),u("div",{ref:(t,z)=>{z.invoiceListSection=t,P.value=t},class:"h-full overflow-y-scroll border-l border-gray-200 border-solid base-scroll"},[(i(!0),w(O,null,_e(c.value,(t,z)=>(i(),w("div",{key:z},[t?(i(),v(k,{key:0,id:"invoice-"+t.id,to:`/admin/invoices/${t.id}/view`,class:H(["flex justify-between side-invoice p-4 cursor-pointer hover:bg-gray-100 items-center border-l-4 border-transparent",{"bg-gray-100 border-l-4 border-gray-500 border-solid":Y(t.id)}]),style:{"border-bottom":"1px solid rgba(185, 193, 209, 0.41)"}},{default:o(()=>[u("div",we,[s(se,{text:t.customer.name,length:30,class:"pr-2 mb-2 text-sm not-italic font-normal leading-5 text-black capitalize truncate"},null,8,["text"]),u("div",Te,g(t.invoice_number),1),s(oe,{status:t.status,class:"px-1 text-xs"},{default:o(()=>[E(g(t.status),1)]),_:2},1032,["status"])]),u("div",Fe,[s(le,{class:"mb-2 text-xl not-italic font-semibold leading-8 text-right text-gray-900 block",amount:t.total,currency:t.customer.currency},null,8,["amount","currency"]),u("div",Ve,g(t.formatted_invoice_date),1)])]),_:2},1032,["id","to","class"])):f("",!0)]))),128)),B.value?(i(),w("div",Ee,[s(be,{class:"h-6 m-1 animate-spin text-primary-400"})])):f("",!0),!((R=c.value)!=null&&R.length)&&!B.value?(i(),w("p",$e,g(e.$t("invoices.no_matching_invoices")),1)):f("",!0)],512)]),u("div",De,[u("iframe",{src:`${r(J)}`,class:"flex-1 border border-gray-400 border-solid bg-white rounded-md frame-style"},null,8,Ne)])]}),_:1})):f("",!0)],64)}}};export{Ue as default};
