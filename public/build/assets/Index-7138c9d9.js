import{e as ie,g as S,F as de,C as pe,a6 as ye,K as _e,l as k,a7 as fe,a8 as be,r as s,o as d,n as b,w as t,a,aa as H,ab as W,m as l,H as g,q as p,t as i,O as B,I as D,a4 as R,b as y,p as M,c as q}from"./main-4279fdc3.js";import{u as Be}from"./payment-8ad825cd.js";import{_ as he}from"./CapsuleIcon-3b1af806.js";import{_ as ve,a as ge}from"./SendPaymentModal-0fe5f8f8.js";import"./mail-driver-cd954e0c.js";const ke={class:"relative table-container"},Ce={class:"relative flex items-center justify-end h-5"},Pe={class:"flex text-sm font-medium cursor-pointer select-none text-primary-400"},Ie={class:"absolute items-center left-6 top-2.5 select-none"},$e={class:"relative block"},Ee={key:0,class:"text-green-600"},Te={key:1,class:"text-red-600"},Ne={setup(Ve){const{t:u}=ie();let h=S(!1),C=S(!0),_=S(null);const r=de({customer:"",payment_mode:"",payment_number:""}),m=Be();pe();const z=ye(),P=_e(),I=k(()=>!m.paymentTotalCount&&!C.value),G=k(()=>[{key:"status",sortable:!1,thClass:"extra w-10",tdClass:"text-left text-sm font-medium extra"},{key:"payment_date",label:u("payments.date"),thClass:"extra",tdClass:"font-medium text-gray-900"},{key:"payment_number",label:u("payments.payment_number")},{key:"name",label:u("payments.customer")},{key:"payment_mode",label:u("payments.payment_mode")},{key:"invoice_number",label:u("invoices.invoice_number")},{key:"amount",label:u("payments.amount")},{key:"from_amount",label:u("payments.from_amount")},{key:"fulfilment",label:"Fulfilment"},{key:"actions",label:"",tdClass:"text-right text-sm font-medium",sortable:!1}]),$=k({get:()=>m.selectedPayments,set:n=>m.selectPayment(n)}),E=k({get:()=>m.selectAllField,set:n=>m.setSelectAllState(n)});fe(r,()=>{X()},{debounce:500}),be(()=>{m.selectAllField&&m.selectAllPayments()}),m.fetchPaymentModes({limit:"all"});async function O(n){return(await m.fetchPaymentModes({search:n})).data.data}function j(){return P.hasAbilities([B.DELETE_PAYMENT,B.EDIT_PAYMENT,B.VIEW_PAYMENT,B.SEND_PAYMENT])}async function K({page:n,filter:o,sort:v}){let V={customer_id:r.customer_id,payment_method_id:r.payment_mode!==null?r.payment_mode:"",payment_number:r.payment_number,orderByField:v.fieldName||"created_at",orderBy:v.order||"desc",page:n};C.value=!0;let c=await m.fetchPayments(V);return C.value=!1,{data:c.data.data,pagination:{totalPages:c.data.meta.last_page,currentPage:n,totalCount:c.data.meta.total,limit:10}}}function T(){_.value&&_.value.refresh()}function X(){T()}function N(){r.customer_id="",r.payment_mode="",r.payment_number=""}function J(){h.value&&N(),h.value=!h.value}function Q(){z.openDialog({title:u("general.are_you_sure"),message:u("payments.confirm_delete",2),yesLabel:u("general.ok"),noLabel:u("general.cancel"),variant:"danger",hideNoButton:!1,size:"lg"}).then(n=>{n&&m.deleteMultiplePayments().then(o=>{o.data.success&&T()})})}return(n,o)=>{const v=s("BaseBreadcrumbItem"),V=s("BaseBreadcrumb"),c=s("BaseIcon"),A=s("BaseButton"),Z=s("BasePageHeader"),ee=s("BaseCustomerSelectInput"),F=s("BaseInputGroup"),te=s("BaseInput"),ae=s("BaseMultiselect"),ne=s("BaseFilterWrapper"),le=s("BaseEmptyPlaceholder"),se=s("BaseDropdownItem"),oe=s("BaseDropdown"),x=s("BaseCheckbox"),me=s("router-link"),re=s("BaseText"),L=s("BaseFormatMoney"),ue=s("BaseTable"),ce=s("BasePage");return d(),b(ce,{class:"payments"},{default:t(()=>[a(ve),a(Z,{title:n.$t("payments.title")},{actions:t(()=>[H(a(A,{variant:"primary-outline",onClick:J},{right:t(e=>[l(h)?(d(),b(c,{key:1,name:"XIcon",class:g(e.class)},null,8,["class"])):(d(),b(c,{key:0,class:g(e.class),name:"FilterIcon"},null,8,["class"]))]),default:t(()=>[p(i(n.$t("general.filter"))+" ",1)]),_:1},512),[[W,l(m).paymentTotalCount]]),l(P).hasAbilities(l(B).CREATE_PAYMENT)?(d(),b(A,{key:0,variant:"primary",class:"ml-4",onClick:o[0]||(o[0]=e=>n.$router.push("/admin/payments/create"))},{left:t(e=>[a(c,{name:"PlusIcon",class:g(e.class)},null,8,["class"])]),default:t(()=>[p(" "+i(n.$t("payments.add_payment")),1)]),_:1})):D("",!0)]),default:t(()=>[a(V,null,{default:t(()=>[a(v,{title:n.$t("general.home"),to:"dashboard"},null,8,["title"]),a(v,{title:n.$t("payments.payment",2),to:"#",active:""},null,8,["title"])]),_:1})]),_:1},8,["title"]),a(ne,{show:l(h),class:"mt-3",onClear:N},{default:t(()=>[a(F,{label:n.$t("payments.customer")},{default:t(()=>[a(ee,{modelValue:l(r).customer_id,"onUpdate:modelValue":o[1]||(o[1]=e=>l(r).customer_id=e),placeholder:n.$t("customers.type_or_click"),"value-prop":"id",label:"name"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(F,{label:n.$t("payments.payment_number")},{default:t(()=>[a(te,{modelValue:l(r).payment_number,"onUpdate:modelValue":o[2]||(o[2]=e=>l(r).payment_number=e)},{left:t(e=>[a(c,{name:"HashtagIcon",class:g(e.class)},null,8,["class"])]),_:1},8,["modelValue"])]),_:1},8,["label"]),a(F,{label:n.$t("payments.payment_mode")},{default:t(()=>[a(ae,{modelValue:l(r).payment_mode,"onUpdate:modelValue":o[3]||(o[3]=e=>l(r).payment_mode=e),"value-prop":"id","track-by":"name","filter-results":!1,label:"name","resolve-on-load":"",delay:500,searchable:"",options:O},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["show"]),l(I)?(d(),b(le,{key:0,title:n.$t("payments.no_payments"),description:n.$t("payments.list_of_payments")},R({default:t(()=>[a(he,{class:"mt-5 mb-4"})]),_:2},[l(P).hasAbilities(l(B).CREATE_PAYMENT)?{name:"actions",fn:t(()=>[a(A,{variant:"primary-outline",onClick:o[4]||(o[4]=e=>n.$router.push("/admin/payments/create"))},{left:t(e=>[a(c,{name:"PlusIcon",class:g(e.class)},null,8,["class"])]),default:t(()=>[p(" "+i(n.$t("payments.add_new_payment")),1)]),_:1})])}:void 0]),1032,["title","description"])):D("",!0),H(y("div",ke,[y("div",Ce,[l(m).selectedPayments.length?(d(),b(oe,{key:0},{activator:t(()=>[y("span",Pe,[p(i(n.$t("general.actions"))+" ",1),a(c,{name:"ChevronDownIcon"})])]),default:t(()=>[a(se,{onClick:Q},{default:t(()=>[a(c,{name:"TrashIcon",class:"mr-3 text-gray-600"}),p(" "+i(n.$t("general.delete")),1)]),_:1})]),_:1})):D("",!0)]),a(ue,{ref:(e,f)=>{f.tableComponent=e,M(_)?_.value=e:_=e},data:K,columns:l(G),"placeholder-count":l(m).paymentTotalCount>=20?10:5,class:"mt-3"},R({header:t(()=>[y("div",Ie,[a(x,{modelValue:l(E),"onUpdate:modelValue":o[5]||(o[5]=e=>M(E)?E.value=e:null),variant:"primary",onChange:l(m).selectAllPayments},null,8,["modelValue","onChange"])])]),"cell-status":t(({row:e})=>[y("div",$e,[a(x,{id:e.id,modelValue:l($),"onUpdate:modelValue":o[6]||(o[6]=f=>M($)?$.value=f:null),value:e.data.id,variant:"primary"},null,8,["id","modelValue","value"])])]),"cell-payment_date":t(({row:e})=>[p(i(e.data.formatted_payment_date),1)]),"cell-payment_number":t(({row:e})=>[a(me,{to:{path:`payments/${e.data.id}/view`},class:"font-medium text-primary-500"},{default:t(()=>[p(i(e.data.payment_number),1)]),_:2},1032,["to"])]),"cell-name":t(({row:e})=>[a(re,{text:e.data.customer.name,length:30,tag:"span"},null,8,["text"])]),"cell-payment_mode":t(({row:e})=>[y("span",null,i(e.data.payment_method?e.data.payment_method.name:"-"),1)]),"cell-invoice_number":t(({row:e})=>{var f,U,Y,w;return[y("span",null,i((U=(f=e==null?void 0:e.data)==null?void 0:f.invoice)!=null&&U.invoice_number?(w=(Y=e==null?void 0:e.data)==null?void 0:Y.invoice)==null?void 0:w.invoice_number:"-"),1)]}),"cell-amount":t(({row:e})=>[a(L,{amount:e.data.amount,currency:e.data.currency},null,8,["amount","currency"])]),"cell-from_amount":t(({row:e})=>[a(L,{amount:e.data.request_amount,currency:e.data.from_currency},null,8,["amount","currency"])]),"cell-fulfilment":t(({row:e})=>[e.data.fulfilment=="FULFILLED"?(d(),q("span",Ee,i(e.data.fulfilment),1)):(d(),q("span",Te,i(e.data.fulfilment),1))]),_:2},[j()?{name:"cell-actions",fn:t(({row:e})=>[a(ge,{row:e.data,table:l(_),contentLoading:l(I),refreshTable:T},null,8,["row","table","contentLoading"])])}:void 0]),1032,["columns","placeholder-count"])],512),[[W,!l(I)]])]),_:1})}}};export{Ne as default};
